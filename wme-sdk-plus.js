var initWmeSdkPlus=function(){"use strict";var Ar=Object.defineProperty,xr=(n,t,o)=>t in n?Ar(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,ht=(n,t,o)=>xr(n,typeof t!="symbol"?t+"":t,o),Vt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Ct={};/*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0

  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.

  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** */var zt;function $r(){if(zt)return Ct;zt=1;var n;return function(t){(function(o){var a=typeof globalThis=="object"?globalThis:typeof Vt=="object"?Vt:typeof self=="object"?self:typeof this=="object"?this:E(),w=v(t);typeof a.Reflect<"u"&&(w=v(a.Reflect,w)),o(w,a),typeof a.Reflect>"u"&&(a.Reflect=t);function v(P,I){return function(T,x){Object.defineProperty(P,T,{configurable:!0,writable:!0,value:x}),I&&I(T,x)}}function S(){try{return Function("return this;")()}catch{}}function O(){try{return(0,eval)("(function() { return this; })()")}catch{}}function E(){return S()||O()}})(function(o,a){var w=Object.prototype.hasOwnProperty,v=typeof Symbol=="function",S=v&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",O=v&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",E=typeof Object.create=="function",P={__proto__:[]}instanceof Array,I=!E&&!P,T={create:E?function(){return L(Object.create(null))}:P?function(){return L({__proto__:null})}:function(){return L({})},has:I?function(e,r){return w.call(e,r)}:function(e,r){return r in e},get:I?function(e,r){return w.call(e,r)?e[r]:void 0}:function(e,r){return e[r]}},x=Object.getPrototypeOf(Function),$=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Ie(),W=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Pe(),K=typeof WeakMap=="function"?WeakMap:Re(),R=v?Symbol.for("@reflect-metadata:registry"):void 0,V=Ee(),J=je(V);function we(e,r,i,s){if(d(i)){if(!ae(e))throw new TypeError;if(!se(r))throw new TypeError;return ve(e,r)}else{if(!ae(e))throw new TypeError;if(!b(r))throw new TypeError;if(!b(s)&&!d(s)&&!A(s))throw new TypeError;return A(s)&&(s=void 0),i=j(i),ge(e,r,i,s)}}o("decorate",we);function F(e,r){function i(s,h){if(!b(s))throw new TypeError;if(!d(h)&&!Se(h))throw new TypeError;te(e,r,s,h)}return i}o("metadata",F);function C(e,r,i,s){if(!b(i))throw new TypeError;return d(s)||(s=j(s)),te(e,r,i,s)}o("defineMetadata",C);function q(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=j(i)),Q(e,r,i)}o("hasMetadata",q);function G(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=j(i)),N(e,r,i)}o("hasOwnMetadata",G);function ye(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=j(i)),X(e,r,i)}o("getMetadata",ye);function Z(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=j(i)),ee(e,r,i)}o("getOwnMetadata",Z);function Y(e,r){if(!b(e))throw new TypeError;return d(r)||(r=j(r)),re(e,r)}o("getMetadataKeys",Y);function pe(e,r){if(!b(e))throw new TypeError;return d(r)||(r=j(r)),ne(e,r)}o("getOwnMetadataKeys",pe);function _e(e,r,i){if(!b(r))throw new TypeError;if(d(i)||(i=j(i)),!b(r))throw new TypeError;d(i)||(i=j(i));var s=D(r,i,!1);return d(s)?!1:s.OrdinaryDeleteMetadata(e,r,i)}o("deleteMetadata",_e);function ve(e,r){for(var i=e.length-1;i>=0;--i){var s=e[i],h=s(r);if(!d(h)&&!A(h)){if(!se(h))throw new TypeError;r=h}}return r}function ge(e,r,i,s){for(var h=e.length-1;h>=0;--h){var k=e[h],m=k(r,i,s);if(!d(m)&&!A(m)){if(!b(m))throw new TypeError;s=m}}return s}function Q(e,r,i){var s=N(e,r,i);if(s)return!0;var h=U(r);return A(h)?!1:Q(e,h,i)}function N(e,r,i){var s=D(r,i,!1);return d(s)?!1:oe(s.OrdinaryHasOwnMetadata(e,r,i))}function X(e,r,i){var s=N(e,r,i);if(s)return ee(e,r,i);var h=U(r);if(!A(h))return X(e,h,i)}function ee(e,r,i){var s=D(r,i,!1);if(!d(s))return s.OrdinaryGetOwnMetadata(e,r,i)}function te(e,r,i,s){var h=D(i,s,!0);h.OrdinaryDefineOwnMetadata(e,r,i,s)}function re(e,r){var i=ne(e,r),s=U(e);if(s===null)return i;var h=re(s,r);if(h.length<=0)return i;if(i.length<=0)return h;for(var k=new W,m=[],p=0,u=i;p<u.length;p++){var c=u[p],f=k.has(c);f||(k.add(c),m.push(c))}for(var l=0,y=h;l<y.length;l++){var c=y[l],f=k.has(c);f||(k.add(c),m.push(c))}return m}function ne(e,r){var i=D(e,r,!1);return i?i.OrdinaryOwnMetadataKeys(e,r):[]}function ie(e){if(e===null)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return e===null?1:6;default:return 6}}function d(e){return e===void 0}function A(e){return e===null}function be(e){return typeof e=="symbol"}function b(e){return typeof e=="object"?e!==null:typeof e=="function"}function me(e,r){switch(ie(e)){case 0:return e;case 1:return e;case 2:return e;case 3:return e;case 4:return e;case 5:return e}var i="string",s=ue(e,S);if(s!==void 0){var h=s.call(e,i);if(b(h))throw new TypeError;return h}return ke(e)}function ke(e,r){var i,s;{var h=e.toString;if(z(h)){var s=h.call(e);if(!b(s))return s}var i=e.valueOf;if(z(i)){var s=i.call(e);if(!b(s))return s}}throw new TypeError}function oe(e){return!!e}function Oe(e){return""+e}function j(e){var r=me(e);return be(r)?r:Oe(r)}function ae(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:Object.prototype.toString.call(e)==="[object Array]"}function z(e){return typeof e=="function"}function se(e){return typeof e=="function"}function Se(e){switch(ie(e)){case 3:return!0;case 4:return!0;default:return!1}}function H(e,r){return e===r||e!==e&&r!==r}function ue(e,r){var i=e[r];if(i!=null){if(!z(i))throw new TypeError;return i}}function ce(e){var r=ue(e,O);if(!z(r))throw new TypeError;var i=r.call(e);if(!b(i))throw new TypeError;return i}function fe(e){return e.value}function le(e){var r=e.next();return r.done?!1:r}function he(e){var r=e.return;r&&r.call(e)}function U(e){var r=Object.getPrototypeOf(e);if(typeof e!="function"||e===x||r!==x)return r;var i=e.prototype,s=i&&Object.getPrototypeOf(i);if(s==null||s===Object.prototype)return r;var h=s.constructor;return typeof h!="function"||h===e?r:h}function Me(){var e;!d(R)&&typeof a.Reflect<"u"&&!(R in a.Reflect)&&typeof a.Reflect.defineMetadata=="function"&&(e=Te(a.Reflect));var r,i,s,h=new K,k={registerProvider:m,getProvider:u,setProvider:f};return k;function m(l){if(!Object.isExtensible(k))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case e===l:break;case d(r):r=l;break;case r===l:break;case d(i):i=l;break;case i===l:break;default:s===void 0&&(s=new W),s.add(l);break}}function p(l,y){if(!d(r)){if(r.isProviderFor(l,y))return r;if(!d(i)){if(i.isProviderFor(l,y))return r;if(!d(s))for(var _=ce(s);;){var g=le(_);if(!g)return;var M=fe(g);if(M.isProviderFor(l,y))return he(_),M}}}if(!d(e)&&e.isProviderFor(l,y))return e}function u(l,y){var _=h.get(l),g;return d(_)||(g=_.get(y)),d(g)&&(g=p(l,y),d(g)||(d(_)&&(_=new $,h.set(l,_)),_.set(y,g))),g}function c(l){if(d(l))throw new TypeError;return r===l||i===l||!d(s)&&s.has(l)}function f(l,y,_){if(!c(_))throw new Error("Metadata provider not registered.");var g=u(l,y);if(g!==_){if(!d(g))return!1;var M=h.get(l);d(M)&&(M=new $,h.set(l,M)),M.set(y,_)}return!0}}function Ee(){var e;return!d(R)&&b(a.Reflect)&&Object.isExtensible(a.Reflect)&&(e=a.Reflect[R]),d(e)&&(e=Me()),!d(R)&&b(a.Reflect)&&Object.isExtensible(a.Reflect)&&Object.defineProperty(a.Reflect,R,{enumerable:!1,configurable:!1,writable:!1,value:e}),e}function je(e){var r=new K,i={isProviderFor:function(c,f){var l=r.get(c);return d(l)?!1:l.has(f)},OrdinaryDefineOwnMetadata:m,OrdinaryHasOwnMetadata:h,OrdinaryGetOwnMetadata:k,OrdinaryOwnMetadataKeys:p,OrdinaryDeleteMetadata:u};return V.registerProvider(i),i;function s(c,f,l){var y=r.get(c),_=!1;if(d(y)){if(!l)return;y=new $,r.set(c,y),_=!0}var g=y.get(f);if(d(g)){if(!l)return;if(g=new $,y.set(f,g),!e.setProvider(c,f,i))throw y.delete(f),_&&r.delete(c),new Error("Wrong provider for target.")}return g}function h(c,f,l){var y=s(f,l,!1);return d(y)?!1:oe(y.has(c))}function k(c,f,l){var y=s(f,l,!1);if(!d(y))return y.get(c)}function m(c,f,l,y){var _=s(l,y,!0);_.set(c,f)}function p(c,f){var l=[],y=s(c,f,!1);if(d(y))return l;for(var _=y.keys(),g=ce(_),M=0;;){var de=le(g);if(!de)return l.length=M,l;var Ae=fe(de);try{l[M]=Ae}catch(xe){try{he(g)}finally{throw xe}}M++}}function u(c,f,l){var y=s(f,l,!1);if(d(y)||!y.delete(c))return!1;if(y.size===0){var _=r.get(f);d(_)||(_.delete(l),_.size===0&&r.delete(_))}return!0}}function Te(e){var r=e.defineMetadata,i=e.hasOwnMetadata,s=e.getOwnMetadata,h=e.getOwnMetadataKeys,k=e.deleteMetadata,m=new K,p={isProviderFor:function(u,c){var f=m.get(u);return!d(f)&&f.has(c)?!0:h(u,c).length?(d(f)&&(f=new W,m.set(u,f)),f.add(c),!0):!1},OrdinaryDefineOwnMetadata:r,OrdinaryHasOwnMetadata:i,OrdinaryGetOwnMetadata:s,OrdinaryOwnMetadataKeys:h,OrdinaryDeleteMetadata:k};return p}function D(e,r,i){var s=V.getProvider(e,r);if(!d(s))return s;if(i){if(V.setProvider(e,r,J))return J;throw new Error("Illegal state.")}}function Ie(){var e={},r=[],i=function(){function p(u,c,f){this._index=0,this._keys=u,this._values=c,this._selector=f}return p.prototype["@@iterator"]=function(){return this},p.prototype[O]=function(){return this},p.prototype.next=function(){var u=this._index;if(u>=0&&u<this._keys.length){var c=this._selector(this._keys[u],this._values[u]);return u+1>=this._keys.length?(this._index=-1,this._keys=r,this._values=r):this._index++,{value:c,done:!1}}return{value:void 0,done:!0}},p.prototype.throw=function(u){throw this._index>=0&&(this._index=-1,this._keys=r,this._values=r),u},p.prototype.return=function(u){return this._index>=0&&(this._index=-1,this._keys=r,this._values=r),{value:u,done:!0}},p}(),s=function(){function p(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(p.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),p.prototype.has=function(u){return this._find(u,!1)>=0},p.prototype.get=function(u){var c=this._find(u,!1);return c>=0?this._values[c]:void 0},p.prototype.set=function(u,c){var f=this._find(u,!0);return this._values[f]=c,this},p.prototype.delete=function(u){var c=this._find(u,!1);if(c>=0){for(var f=this._keys.length,l=c+1;l<f;l++)this._keys[l-1]=this._keys[l],this._values[l-1]=this._values[l];return this._keys.length--,this._values.length--,H(u,this._cacheKey)&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},p.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},p.prototype.keys=function(){return new i(this._keys,this._values,h)},p.prototype.values=function(){return new i(this._keys,this._values,k)},p.prototype.entries=function(){return new i(this._keys,this._values,m)},p.prototype["@@iterator"]=function(){return this.entries()},p.prototype[O]=function(){return this.entries()},p.prototype._find=function(u,c){if(!H(this._cacheKey,u)){this._cacheIndex=-1;for(var f=0;f<this._keys.length;f++)if(H(this._keys[f],u)){this._cacheIndex=f;break}}return this._cacheIndex<0&&c&&(this._cacheIndex=this._keys.length,this._keys.push(u),this._values.push(void 0)),this._cacheIndex},p}();return s;function h(p,u){return p}function k(p,u){return u}function m(p,u){return[p,u]}}function Pe(){var e=function(){function r(){this._map=new $}return Object.defineProperty(r.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),r.prototype.has=function(i){return this._map.has(i)},r.prototype.add=function(i){return this._map.set(i,i),this},r.prototype.delete=function(i){return this._map.delete(i)},r.prototype.clear=function(){this._map.clear()},r.prototype.keys=function(){return this._map.keys()},r.prototype.values=function(){return this._map.keys()},r.prototype.entries=function(){return this._map.entries()},r.prototype["@@iterator"]=function(){return this.keys()},r.prototype[O]=function(){return this.keys()},r}();return e}function Re(){var e=16,r=T.create(),i=s();return function(){function u(){this._key=s()}return u.prototype.has=function(c){var f=h(c,!1);return f!==void 0?T.has(f,this._key):!1},u.prototype.get=function(c){var f=h(c,!1);return f!==void 0?T.get(f,this._key):void 0},u.prototype.set=function(c,f){var l=h(c,!0);return l[this._key]=f,this},u.prototype.delete=function(c){var f=h(c,!1);return f!==void 0?delete f[this._key]:!1},u.prototype.clear=function(){this._key=s()},u}();function s(){var u;do u="@@WeakMap@@"+p();while(T.has(r,u));return r[u]=!0,u}function h(u,c){if(!w.call(u,i)){if(!c)return;Object.defineProperty(u,i,{value:T.create()})}return u[i]}function k(u,c){for(var f=0;f<c;++f)u[f]=Math.random()*255|0;return u}function m(u){if(typeof Uint8Array=="function"){var c=new Uint8Array(u);return typeof crypto<"u"?crypto.getRandomValues(c):typeof msCrypto<"u"?msCrypto.getRandomValues(c):k(c,u),c}return k(new Array(u),u)}function p(){var u=m(e);u[6]=u[6]&79|64,u[8]=u[8]&191|128;for(var c="",f=0;f<e;++f){var l=u[f];(f===4||f===6||f===8)&&(c+="-"),l<16&&(c+="0"),c+=l.toString(16).toLowerCase()}return c}}function L(e){return e.__=void 0,delete e.__,e}})}(n||(n={})),Ct}$r();const dt=Symbol("ARTIFACTS");let Dr=class{constructor(t){ht(this,"_recognizableHooks",new Map),ht(this,"_hookDependencies",new Map),ht(this,"_installedHooks",new Map);for(const[o,{hook:a,deps:w}]of Object.entries(t))this._recognizableHooks.set(o,a),w&&this._hookDependencies.set(o,w||[])}isHookInstalled(t,o){const a=this._recognizableHooks.get(o);if(!a||!this._installedHooks.has(t))return!1;const w=this._installedHooks.get(t);return w?w.some(v=>v===a):!1}markHookAsInstalled(t,o){var a;const w=this._recognizableHooks.get(o);if(!w)throw new Error(`Hook ${o} not found`);this._installedHooks.has(t)||this._installedHooks.set(t,[]),(a=this._installedHooks.get(t))==null||a.push(w)}async installHook(t,o){const a=this._recognizableHooks.get(t);if(!a)throw new Error(`Hook ${t} not found`);if(this.isHookInstalled(o,t))return;const w=this._hookDependencies.get(t)||[];for(const S of w)await this.installHook(S,o);const v=Reflect.getMetadata(dt,o)||{};Reflect.hasMetadata(dt,o)||Reflect.defineMetadata(dt,v,o);for(const S of a){if(typeof S=="function"){await S({sdk:o,artifacts:v});continue}const O=await S.install({sdk:o,artifacts:v});!O||typeof O!="object"||Object.assign(v,O)}this.markHookAsInstalled(o,t)}async installAllHooks(t){for(const o of this._recognizableHooks.keys())await this.installHook(o,t)}};var Fr=Object.defineProperty,Vr=(n,t,o)=>t in n?Fr(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,We=(n,t,o)=>Vr(n,typeof t!="symbol"?t+"":t,o),Cr=Object.defineProperty,zr=(n,t,o)=>t in n?Cr(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,rt=(n,t,o)=>zr(n,typeof t!="symbol"?t+"":t,o),Kt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Wt={};/*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0

  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.

  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** */var Nt;function Kr(){if(Nt)return Wt;Nt=1;var n;return function(t){(function(o){var a=typeof globalThis=="object"?globalThis:typeof Kt=="object"?Kt:typeof self=="object"?self:typeof this=="object"?this:E(),w=v(t);typeof a.Reflect<"u"&&(w=v(a.Reflect,w)),o(w,a),typeof a.Reflect>"u"&&(a.Reflect=t);function v(P,I){return function(T,x){Object.defineProperty(P,T,{configurable:!0,writable:!0,value:x}),I&&I(T,x)}}function S(){try{return Function("return this;")()}catch{}}function O(){try{return(0,eval)("(function() { return this; })()")}catch{}}function E(){return S()||O()}})(function(o,a){var w=Object.prototype.hasOwnProperty,v=typeof Symbol=="function",S=v&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",O=v&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",E=typeof Object.create=="function",P={__proto__:[]}instanceof Array,I=!E&&!P,T={create:E?function(){return L(Object.create(null))}:P?function(){return L({__proto__:null})}:function(){return L({})},has:I?function(e,r){return w.call(e,r)}:function(e,r){return r in e},get:I?function(e,r){return w.call(e,r)?e[r]:void 0}:function(e,r){return e[r]}},x=Object.getPrototypeOf(Function),$=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Ie(),W=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Pe(),K=typeof WeakMap=="function"?WeakMap:Re(),R=v?Symbol.for("@reflect-metadata:registry"):void 0,V=Ee(),J=je(V);function we(e,r,i,s){if(d(i)){if(!ae(e))throw new TypeError;if(!se(r))throw new TypeError;return ve(e,r)}else{if(!ae(e))throw new TypeError;if(!b(r))throw new TypeError;if(!b(s)&&!d(s)&&!A(s))throw new TypeError;return A(s)&&(s=void 0),i=j(i),ge(e,r,i,s)}}o("decorate",we);function F(e,r){function i(s,h){if(!b(s))throw new TypeError;if(!d(h)&&!Se(h))throw new TypeError;te(e,r,s,h)}return i}o("metadata",F);function C(e,r,i,s){if(!b(i))throw new TypeError;return d(s)||(s=j(s)),te(e,r,i,s)}o("defineMetadata",C);function q(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=j(i)),Q(e,r,i)}o("hasMetadata",q);function G(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=j(i)),N(e,r,i)}o("hasOwnMetadata",G);function ye(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=j(i)),X(e,r,i)}o("getMetadata",ye);function Z(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=j(i)),ee(e,r,i)}o("getOwnMetadata",Z);function Y(e,r){if(!b(e))throw new TypeError;return d(r)||(r=j(r)),re(e,r)}o("getMetadataKeys",Y);function pe(e,r){if(!b(e))throw new TypeError;return d(r)||(r=j(r)),ne(e,r)}o("getOwnMetadataKeys",pe);function _e(e,r,i){if(!b(r))throw new TypeError;if(d(i)||(i=j(i)),!b(r))throw new TypeError;d(i)||(i=j(i));var s=D(r,i,!1);return d(s)?!1:s.OrdinaryDeleteMetadata(e,r,i)}o("deleteMetadata",_e);function ve(e,r){for(var i=e.length-1;i>=0;--i){var s=e[i],h=s(r);if(!d(h)&&!A(h)){if(!se(h))throw new TypeError;r=h}}return r}function ge(e,r,i,s){for(var h=e.length-1;h>=0;--h){var k=e[h],m=k(r,i,s);if(!d(m)&&!A(m)){if(!b(m))throw new TypeError;s=m}}return s}function Q(e,r,i){var s=N(e,r,i);if(s)return!0;var h=U(r);return A(h)?!1:Q(e,h,i)}function N(e,r,i){var s=D(r,i,!1);return d(s)?!1:oe(s.OrdinaryHasOwnMetadata(e,r,i))}function X(e,r,i){var s=N(e,r,i);if(s)return ee(e,r,i);var h=U(r);if(!A(h))return X(e,h,i)}function ee(e,r,i){var s=D(r,i,!1);if(!d(s))return s.OrdinaryGetOwnMetadata(e,r,i)}function te(e,r,i,s){var h=D(i,s,!0);h.OrdinaryDefineOwnMetadata(e,r,i,s)}function re(e,r){var i=ne(e,r),s=U(e);if(s===null)return i;var h=re(s,r);if(h.length<=0)return i;if(i.length<=0)return h;for(var k=new W,m=[],p=0,u=i;p<u.length;p++){var c=u[p],f=k.has(c);f||(k.add(c),m.push(c))}for(var l=0,y=h;l<y.length;l++){var c=y[l],f=k.has(c);f||(k.add(c),m.push(c))}return m}function ne(e,r){var i=D(e,r,!1);return i?i.OrdinaryOwnMetadataKeys(e,r):[]}function ie(e){if(e===null)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return e===null?1:6;default:return 6}}function d(e){return e===void 0}function A(e){return e===null}function be(e){return typeof e=="symbol"}function b(e){return typeof e=="object"?e!==null:typeof e=="function"}function me(e,r){switch(ie(e)){case 0:return e;case 1:return e;case 2:return e;case 3:return e;case 4:return e;case 5:return e}var i="string",s=ue(e,S);if(s!==void 0){var h=s.call(e,i);if(b(h))throw new TypeError;return h}return ke(e)}function ke(e,r){var i,s;{var h=e.toString;if(z(h)){var s=h.call(e);if(!b(s))return s}var i=e.valueOf;if(z(i)){var s=i.call(e);if(!b(s))return s}}throw new TypeError}function oe(e){return!!e}function Oe(e){return""+e}function j(e){var r=me(e);return be(r)?r:Oe(r)}function ae(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:Object.prototype.toString.call(e)==="[object Array]"}function z(e){return typeof e=="function"}function se(e){return typeof e=="function"}function Se(e){switch(ie(e)){case 3:return!0;case 4:return!0;default:return!1}}function H(e,r){return e===r||e!==e&&r!==r}function ue(e,r){var i=e[r];if(i!=null){if(!z(i))throw new TypeError;return i}}function ce(e){var r=ue(e,O);if(!z(r))throw new TypeError;var i=r.call(e);if(!b(i))throw new TypeError;return i}function fe(e){return e.value}function le(e){var r=e.next();return r.done?!1:r}function he(e){var r=e.return;r&&r.call(e)}function U(e){var r=Object.getPrototypeOf(e);if(typeof e!="function"||e===x||r!==x)return r;var i=e.prototype,s=i&&Object.getPrototypeOf(i);if(s==null||s===Object.prototype)return r;var h=s.constructor;return typeof h!="function"||h===e?r:h}function Me(){var e;!d(R)&&typeof a.Reflect<"u"&&!(R in a.Reflect)&&typeof a.Reflect.defineMetadata=="function"&&(e=Te(a.Reflect));var r,i,s,h=new K,k={registerProvider:m,getProvider:u,setProvider:f};return k;function m(l){if(!Object.isExtensible(k))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case e===l:break;case d(r):r=l;break;case r===l:break;case d(i):i=l;break;case i===l:break;default:s===void 0&&(s=new W),s.add(l);break}}function p(l,y){if(!d(r)){if(r.isProviderFor(l,y))return r;if(!d(i)){if(i.isProviderFor(l,y))return r;if(!d(s))for(var _=ce(s);;){var g=le(_);if(!g)return;var M=fe(g);if(M.isProviderFor(l,y))return he(_),M}}}if(!d(e)&&e.isProviderFor(l,y))return e}function u(l,y){var _=h.get(l),g;return d(_)||(g=_.get(y)),d(g)&&(g=p(l,y),d(g)||(d(_)&&(_=new $,h.set(l,_)),_.set(y,g))),g}function c(l){if(d(l))throw new TypeError;return r===l||i===l||!d(s)&&s.has(l)}function f(l,y,_){if(!c(_))throw new Error("Metadata provider not registered.");var g=u(l,y);if(g!==_){if(!d(g))return!1;var M=h.get(l);d(M)&&(M=new $,h.set(l,M)),M.set(y,_)}return!0}}function Ee(){var e;return!d(R)&&b(a.Reflect)&&Object.isExtensible(a.Reflect)&&(e=a.Reflect[R]),d(e)&&(e=Me()),!d(R)&&b(a.Reflect)&&Object.isExtensible(a.Reflect)&&Object.defineProperty(a.Reflect,R,{enumerable:!1,configurable:!1,writable:!1,value:e}),e}function je(e){var r=new K,i={isProviderFor:function(c,f){var l=r.get(c);return d(l)?!1:l.has(f)},OrdinaryDefineOwnMetadata:m,OrdinaryHasOwnMetadata:h,OrdinaryGetOwnMetadata:k,OrdinaryOwnMetadataKeys:p,OrdinaryDeleteMetadata:u};return V.registerProvider(i),i;function s(c,f,l){var y=r.get(c),_=!1;if(d(y)){if(!l)return;y=new $,r.set(c,y),_=!0}var g=y.get(f);if(d(g)){if(!l)return;if(g=new $,y.set(f,g),!e.setProvider(c,f,i))throw y.delete(f),_&&r.delete(c),new Error("Wrong provider for target.")}return g}function h(c,f,l){var y=s(f,l,!1);return d(y)?!1:oe(y.has(c))}function k(c,f,l){var y=s(f,l,!1);if(!d(y))return y.get(c)}function m(c,f,l,y){var _=s(l,y,!0);_.set(c,f)}function p(c,f){var l=[],y=s(c,f,!1);if(d(y))return l;for(var _=y.keys(),g=ce(_),M=0;;){var de=le(g);if(!de)return l.length=M,l;var Ae=fe(de);try{l[M]=Ae}catch(xe){try{he(g)}finally{throw xe}}M++}}function u(c,f,l){var y=s(f,l,!1);if(d(y)||!y.delete(c))return!1;if(y.size===0){var _=r.get(f);d(_)||(_.delete(l),_.size===0&&r.delete(_))}return!0}}function Te(e){var r=e.defineMetadata,i=e.hasOwnMetadata,s=e.getOwnMetadata,h=e.getOwnMetadataKeys,k=e.deleteMetadata,m=new K,p={isProviderFor:function(u,c){var f=m.get(u);return!d(f)&&f.has(c)?!0:h(u,c).length?(d(f)&&(f=new W,m.set(u,f)),f.add(c),!0):!1},OrdinaryDefineOwnMetadata:r,OrdinaryHasOwnMetadata:i,OrdinaryGetOwnMetadata:s,OrdinaryOwnMetadataKeys:h,OrdinaryDeleteMetadata:k};return p}function D(e,r,i){var s=V.getProvider(e,r);if(!d(s))return s;if(i){if(V.setProvider(e,r,J))return J;throw new Error("Illegal state.")}}function Ie(){var e={},r=[],i=function(){function p(u,c,f){this._index=0,this._keys=u,this._values=c,this._selector=f}return p.prototype["@@iterator"]=function(){return this},p.prototype[O]=function(){return this},p.prototype.next=function(){var u=this._index;if(u>=0&&u<this._keys.length){var c=this._selector(this._keys[u],this._values[u]);return u+1>=this._keys.length?(this._index=-1,this._keys=r,this._values=r):this._index++,{value:c,done:!1}}return{value:void 0,done:!0}},p.prototype.throw=function(u){throw this._index>=0&&(this._index=-1,this._keys=r,this._values=r),u},p.prototype.return=function(u){return this._index>=0&&(this._index=-1,this._keys=r,this._values=r),{value:u,done:!0}},p}(),s=function(){function p(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(p.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),p.prototype.has=function(u){return this._find(u,!1)>=0},p.prototype.get=function(u){var c=this._find(u,!1);return c>=0?this._values[c]:void 0},p.prototype.set=function(u,c){var f=this._find(u,!0);return this._values[f]=c,this},p.prototype.delete=function(u){var c=this._find(u,!1);if(c>=0){for(var f=this._keys.length,l=c+1;l<f;l++)this._keys[l-1]=this._keys[l],this._values[l-1]=this._values[l];return this._keys.length--,this._values.length--,H(u,this._cacheKey)&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},p.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},p.prototype.keys=function(){return new i(this._keys,this._values,h)},p.prototype.values=function(){return new i(this._keys,this._values,k)},p.prototype.entries=function(){return new i(this._keys,this._values,m)},p.prototype["@@iterator"]=function(){return this.entries()},p.prototype[O]=function(){return this.entries()},p.prototype._find=function(u,c){if(!H(this._cacheKey,u)){this._cacheIndex=-1;for(var f=0;f<this._keys.length;f++)if(H(this._keys[f],u)){this._cacheIndex=f;break}}return this._cacheIndex<0&&c&&(this._cacheIndex=this._keys.length,this._keys.push(u),this._values.push(void 0)),this._cacheIndex},p}();return s;function h(p,u){return p}function k(p,u){return u}function m(p,u){return[p,u]}}function Pe(){var e=function(){function r(){this._map=new $}return Object.defineProperty(r.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),r.prototype.has=function(i){return this._map.has(i)},r.prototype.add=function(i){return this._map.set(i,i),this},r.prototype.delete=function(i){return this._map.delete(i)},r.prototype.clear=function(){this._map.clear()},r.prototype.keys=function(){return this._map.keys()},r.prototype.values=function(){return this._map.keys()},r.prototype.entries=function(){return this._map.entries()},r.prototype["@@iterator"]=function(){return this.keys()},r.prototype[O]=function(){return this.keys()},r}();return e}function Re(){var e=16,r=T.create(),i=s();return function(){function u(){this._key=s()}return u.prototype.has=function(c){var f=h(c,!1);return f!==void 0?T.has(f,this._key):!1},u.prototype.get=function(c){var f=h(c,!1);return f!==void 0?T.get(f,this._key):void 0},u.prototype.set=function(c,f){var l=h(c,!0);return l[this._key]=f,this},u.prototype.delete=function(c){var f=h(c,!1);return f!==void 0?delete f[this._key]:!1},u.prototype.clear=function(){this._key=s()},u}();function s(){var u;do u="@@WeakMap@@"+p();while(T.has(r,u));return r[u]=!0,u}function h(u,c){if(!w.call(u,i)){if(!c)return;Object.defineProperty(u,i,{value:T.create()})}return u[i]}function k(u,c){for(var f=0;f<c;++f)u[f]=Math.random()*255|0;return u}function m(u){if(typeof Uint8Array=="function"){var c=new Uint8Array(u);return typeof crypto<"u"?crypto.getRandomValues(c):typeof msCrypto<"u"?msCrypto.getRandomValues(c):k(c,u),c}return k(new Array(u),u)}function p(){var u=m(e);u[6]=u[6]&79|64,u[8]=u[8]&191|128;for(var c="",f=0;f<e;++f){var l=u[f];(f===4||f===6||f===8)&&(c+="-"),l<16&&(c+="0"),c+=l.toString(16).toLowerCase()}return c}}function L(e){return e.__=void 0,delete e.__,e}})}(n||(n={})),Wt}Kr();var Wr=Object.defineProperty,Nr=(n,t,o)=>t in n?Wr(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,Ne=(n,t,o)=>Nr(n,typeof t!="symbol"?t+"":t,o);let Hr=class{constructor(t,o){Ne(this,"_target"),Ne(this,"_key"),Ne(this,"_oldValue"),Ne(this,"_wasDefined",!1),Ne(this,"_isSwapped",!1),this._target=t,this._key=o,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}};const Ur={onlyIfNotExists:!0,isFactory:!1};class nt{constructor(t,o,a={}){if(rt(this,"_installedInstances",new Map),rt(this,"_path"),rt(this,"_targetValue"),rt(this,"_options"),this._path=t.split("."),this._path.length===0)throw new Error("Path must not be empty");this._targetValue=o,this._options={...Ur,...a}}_getTargetObject(t){let o=t;for(const a of this._path.slice(0,this._path.length-1))o[a]||(o[a]={}),o=o[a];return o}_createSwapper(t){const o=this._getTargetObject(t);return new Hr(o,this._path.at(-1))}install({sdk:t,...o}){if(this._installedInstances.has(t))return;const a=this._createSwapper(t);if(!(a.value&&this._options.onlyIfNotExists)){if(this._options.isFactory&&typeof this._targetValue=="function"){const w=this._targetValue({sdk:t,...o});a.swap(w)}else a.swap(this._targetValue);this._installedInstances.set(t,a)}}uninstall({sdk:t}){const o=this._installedInstances.get(t);o&&(o.restore(),this._installedInstances.delete(t))}}function Ht(){return"unsafeWindow"in window?window.unsafeWindow:window}var Lr=Object.defineProperty,qr=(n,t,o)=>t in n?Lr(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,$e=(n,t,o)=>qr(n,typeof t!="symbol"?t+"":t,o);class Gr{constructor(t,o){$e(this,"_target"),$e(this,"_key"),$e(this,"_oldValue"),$e(this,"_wasDefined",!1),$e(this,"_isSwapped",!1),this._target=t,this._key=o,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}}let pt=class{constructor(t,o,a){$e(this,"_enabled",!1),$e(this,"_fnSwapper"),$e(this,"_interceptionFunction"),$e(this,"_middlewares",[]),this._fnSwapper=new Gr(t,o),this._interceptionFunction=a}get enabled(){return this._fnSwapper.isSwapped&&this._enabled}disable(){this._enabled=!1,this.enabled}restore(){this._fnSwapper.restore()}enable(){this._enabled=!0,this._fnSwapper.isSwapped||this.swapToInterceptor()}swapToInterceptor(){const t=this;this._fnSwapper.swap(function(...o){if(!t._enabled)return t.callOriginalInvocator(...o);const a=t.runMiddlewares(o);if(a){if("output"in a)return a.output;"input"in a&&(o=a.input)}return t._interceptionFunction.call(this,t.getOriginalInvocator(this),...o)})}getOriginalInvocator(t){return this._fnSwapper.originalValue.bind(t??this._fnSwapper.target)}callOriginalInvocator(...t){return this.getOriginalInvocator()(...t)}runMiddlewares(t){for(const o of this._middlewares){const a=o(...t);if(a){if("output"in a)return a;"input"in a&&(t=a.input)}}return{input:t}}registerMiddleware(t){this._middlewares.push(t)}};function Br(n,t){try{return n()}catch{return t}}let Jr=class extends pt{constructor(t,o,a){super(t,o,a),$e(this,"_loggedInvocationRequests",[]),this.registerMiddleware((...w)=>this.logRequest(...w))}logRequest(...t){this._loggedInvocationRequests.push(t)}flushLoggedRequests(){const t=this.getLoggedRequests();return this._loggedInvocationRequests=[],t}getLoggedRequests(){return this._loggedInvocationRequests}executeOriginalLoggedRequests(){this.flushLoggedRequests().forEach(t=>Br(()=>this.callOriginalInvocator(...t)))}};class Zr{constructor(){We(this,"_hasResult",!1),We(this,"result")}store(t){return this.result=t,this._hasResult=!0,t}clear(){this.result=void 0,this._hasResult=!1}getResult(){if(!this.hasResult)throw new Error("No result is stored");return this.result}get hasResult(){return this._hasResult}}function Yr(n){const t=new Zr;new pt(n,"doAction",(o,...a)=>t.hasResult?t.getResult():t.store(o(...a))).enable(),new pt(n,"undoAction",(o,...a)=>{const w=o(...a);return t.clear(),w}).enable()}let Qr=class{constructor(){We(this,"actions",[]),We(this,"undoableActions",[])}acceptAction(t,o){const a={action:t,dataModel:o};t.undoSupported()&&(Yr(t),t.doAction(o),this.undoableActions.push(a)),this.actions.push(a)}undoAll(){this.undoableActions.forEach(({action:t,dataModel:o})=>t.undoAction(o))}getActions(){return this.actions.map(({action:t})=>t)}};function Xr(){try{return Ht().require("Waze/Action/MultiAction")}catch{return null}}function en(n){const t=Xr();if(!t)throw new Error("Unable to retrieve MultiAction");return new t(n)}let tn=class{constructor(t){We(this,"_activeTransaction",null),We(this,"_actionManagerAddInterceptor"),this._actionManagerAddInterceptor=new Jr(t,"add",(o,a)=>{var w,v;return(v=(w=this._activeTransaction)==null?void 0:w.acceptAction)==null||v.call(w,a,t.dataModel),!0})}openTransaction(){this._activeTransaction=new Qr,this._actionManagerAddInterceptor.enable()}closeTransaction(){const t=this._activeTransaction;return this._activeTransaction=null,this._actionManagerAddInterceptor.flushLoggedRequests(),this._actionManagerAddInterceptor.disable(),t}get hasTransaction(){return this._activeTransaction!==null}beginTransaction(){this.openTransaction()}commitTransaction(t){if(!this.hasTransaction)throw new Error("No open transaction found");try{const o=this._activeTransaction.getActions(),a=en(o);t&&(a._description=t),this._actionManagerAddInterceptor.callOriginalInvocator(a)}catch{this._actionManagerAddInterceptor.executeOriginalLoggedRequests()}finally{this.closeTransaction()}}cancelTransaction(){var t;(t=this._activeTransaction)==null||t.undoAll(),this.closeTransaction()}},yt;function it(){if(!yt){const n=Ht();yt=new tn(n.W.model.actionManager)}return yt}const rn=[new nt("Editing.beginTransaction",()=>it().beginTransaction()),new nt("Editing.commitTransaction",n=>it().commitTransaction(n)),new nt("Editing.cancelTransaction",()=>it().cancelTransaction()),new nt("Editing.doActions",(n,t)=>{const o=it();o.beginTransaction();try{n(),o.commitTransaction(t)}catch(a){throw o.cancelTransaction(),a}})];var nn=Object.defineProperty,on=(n,t,o)=>t in n?nn(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,ot=(n,t,o)=>on(n,typeof t!="symbol"?t+"":t,o),Ut=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Lt={};/*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0

  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.

  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** */var qt;function an(){if(qt)return Lt;qt=1;var n;return function(t){(function(o){var a=typeof globalThis=="object"?globalThis:typeof Ut=="object"?Ut:typeof self=="object"?self:typeof this=="object"?this:E(),w=v(t);typeof a.Reflect<"u"&&(w=v(a.Reflect,w)),o(w,a),typeof a.Reflect>"u"&&(a.Reflect=t);function v(P,I){return function(T,x){Object.defineProperty(P,T,{configurable:!0,writable:!0,value:x}),I&&I(T,x)}}function S(){try{return Function("return this;")()}catch{}}function O(){try{return(0,eval)("(function() { return this; })()")}catch{}}function E(){return S()||O()}})(function(o,a){var w=Object.prototype.hasOwnProperty,v=typeof Symbol=="function",S=v&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",O=v&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",E=typeof Object.create=="function",P={__proto__:[]}instanceof Array,I=!E&&!P,T={create:E?function(){return L(Object.create(null))}:P?function(){return L({__proto__:null})}:function(){return L({})},has:I?function(e,r){return w.call(e,r)}:function(e,r){return r in e},get:I?function(e,r){return w.call(e,r)?e[r]:void 0}:function(e,r){return e[r]}},x=Object.getPrototypeOf(Function),$=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Ie(),W=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Pe(),K=typeof WeakMap=="function"?WeakMap:Re(),R=v?Symbol.for("@reflect-metadata:registry"):void 0,V=Ee(),J=je(V);function we(e,r,i,s){if(d(i)){if(!ae(e))throw new TypeError;if(!se(r))throw new TypeError;return ve(e,r)}else{if(!ae(e))throw new TypeError;if(!b(r))throw new TypeError;if(!b(s)&&!d(s)&&!A(s))throw new TypeError;return A(s)&&(s=void 0),i=j(i),ge(e,r,i,s)}}o("decorate",we);function F(e,r){function i(s,h){if(!b(s))throw new TypeError;if(!d(h)&&!Se(h))throw new TypeError;te(e,r,s,h)}return i}o("metadata",F);function C(e,r,i,s){if(!b(i))throw new TypeError;return d(s)||(s=j(s)),te(e,r,i,s)}o("defineMetadata",C);function q(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=j(i)),Q(e,r,i)}o("hasMetadata",q);function G(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=j(i)),N(e,r,i)}o("hasOwnMetadata",G);function ye(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=j(i)),X(e,r,i)}o("getMetadata",ye);function Z(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=j(i)),ee(e,r,i)}o("getOwnMetadata",Z);function Y(e,r){if(!b(e))throw new TypeError;return d(r)||(r=j(r)),re(e,r)}o("getMetadataKeys",Y);function pe(e,r){if(!b(e))throw new TypeError;return d(r)||(r=j(r)),ne(e,r)}o("getOwnMetadataKeys",pe);function _e(e,r,i){if(!b(r))throw new TypeError;if(d(i)||(i=j(i)),!b(r))throw new TypeError;d(i)||(i=j(i));var s=D(r,i,!1);return d(s)?!1:s.OrdinaryDeleteMetadata(e,r,i)}o("deleteMetadata",_e);function ve(e,r){for(var i=e.length-1;i>=0;--i){var s=e[i],h=s(r);if(!d(h)&&!A(h)){if(!se(h))throw new TypeError;r=h}}return r}function ge(e,r,i,s){for(var h=e.length-1;h>=0;--h){var k=e[h],m=k(r,i,s);if(!d(m)&&!A(m)){if(!b(m))throw new TypeError;s=m}}return s}function Q(e,r,i){var s=N(e,r,i);if(s)return!0;var h=U(r);return A(h)?!1:Q(e,h,i)}function N(e,r,i){var s=D(r,i,!1);return d(s)?!1:oe(s.OrdinaryHasOwnMetadata(e,r,i))}function X(e,r,i){var s=N(e,r,i);if(s)return ee(e,r,i);var h=U(r);if(!A(h))return X(e,h,i)}function ee(e,r,i){var s=D(r,i,!1);if(!d(s))return s.OrdinaryGetOwnMetadata(e,r,i)}function te(e,r,i,s){var h=D(i,s,!0);h.OrdinaryDefineOwnMetadata(e,r,i,s)}function re(e,r){var i=ne(e,r),s=U(e);if(s===null)return i;var h=re(s,r);if(h.length<=0)return i;if(i.length<=0)return h;for(var k=new W,m=[],p=0,u=i;p<u.length;p++){var c=u[p],f=k.has(c);f||(k.add(c),m.push(c))}for(var l=0,y=h;l<y.length;l++){var c=y[l],f=k.has(c);f||(k.add(c),m.push(c))}return m}function ne(e,r){var i=D(e,r,!1);return i?i.OrdinaryOwnMetadataKeys(e,r):[]}function ie(e){if(e===null)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return e===null?1:6;default:return 6}}function d(e){return e===void 0}function A(e){return e===null}function be(e){return typeof e=="symbol"}function b(e){return typeof e=="object"?e!==null:typeof e=="function"}function me(e,r){switch(ie(e)){case 0:return e;case 1:return e;case 2:return e;case 3:return e;case 4:return e;case 5:return e}var i="string",s=ue(e,S);if(s!==void 0){var h=s.call(e,i);if(b(h))throw new TypeError;return h}return ke(e)}function ke(e,r){var i,s;{var h=e.toString;if(z(h)){var s=h.call(e);if(!b(s))return s}var i=e.valueOf;if(z(i)){var s=i.call(e);if(!b(s))return s}}throw new TypeError}function oe(e){return!!e}function Oe(e){return""+e}function j(e){var r=me(e);return be(r)?r:Oe(r)}function ae(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:Object.prototype.toString.call(e)==="[object Array]"}function z(e){return typeof e=="function"}function se(e){return typeof e=="function"}function Se(e){switch(ie(e)){case 3:return!0;case 4:return!0;default:return!1}}function H(e,r){return e===r||e!==e&&r!==r}function ue(e,r){var i=e[r];if(i!=null){if(!z(i))throw new TypeError;return i}}function ce(e){var r=ue(e,O);if(!z(r))throw new TypeError;var i=r.call(e);if(!b(i))throw new TypeError;return i}function fe(e){return e.value}function le(e){var r=e.next();return r.done?!1:r}function he(e){var r=e.return;r&&r.call(e)}function U(e){var r=Object.getPrototypeOf(e);if(typeof e!="function"||e===x||r!==x)return r;var i=e.prototype,s=i&&Object.getPrototypeOf(i);if(s==null||s===Object.prototype)return r;var h=s.constructor;return typeof h!="function"||h===e?r:h}function Me(){var e;!d(R)&&typeof a.Reflect<"u"&&!(R in a.Reflect)&&typeof a.Reflect.defineMetadata=="function"&&(e=Te(a.Reflect));var r,i,s,h=new K,k={registerProvider:m,getProvider:u,setProvider:f};return k;function m(l){if(!Object.isExtensible(k))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case e===l:break;case d(r):r=l;break;case r===l:break;case d(i):i=l;break;case i===l:break;default:s===void 0&&(s=new W),s.add(l);break}}function p(l,y){if(!d(r)){if(r.isProviderFor(l,y))return r;if(!d(i)){if(i.isProviderFor(l,y))return r;if(!d(s))for(var _=ce(s);;){var g=le(_);if(!g)return;var M=fe(g);if(M.isProviderFor(l,y))return he(_),M}}}if(!d(e)&&e.isProviderFor(l,y))return e}function u(l,y){var _=h.get(l),g;return d(_)||(g=_.get(y)),d(g)&&(g=p(l,y),d(g)||(d(_)&&(_=new $,h.set(l,_)),_.set(y,g))),g}function c(l){if(d(l))throw new TypeError;return r===l||i===l||!d(s)&&s.has(l)}function f(l,y,_){if(!c(_))throw new Error("Metadata provider not registered.");var g=u(l,y);if(g!==_){if(!d(g))return!1;var M=h.get(l);d(M)&&(M=new $,h.set(l,M)),M.set(y,_)}return!0}}function Ee(){var e;return!d(R)&&b(a.Reflect)&&Object.isExtensible(a.Reflect)&&(e=a.Reflect[R]),d(e)&&(e=Me()),!d(R)&&b(a.Reflect)&&Object.isExtensible(a.Reflect)&&Object.defineProperty(a.Reflect,R,{enumerable:!1,configurable:!1,writable:!1,value:e}),e}function je(e){var r=new K,i={isProviderFor:function(c,f){var l=r.get(c);return d(l)?!1:l.has(f)},OrdinaryDefineOwnMetadata:m,OrdinaryHasOwnMetadata:h,OrdinaryGetOwnMetadata:k,OrdinaryOwnMetadataKeys:p,OrdinaryDeleteMetadata:u};return V.registerProvider(i),i;function s(c,f,l){var y=r.get(c),_=!1;if(d(y)){if(!l)return;y=new $,r.set(c,y),_=!0}var g=y.get(f);if(d(g)){if(!l)return;if(g=new $,y.set(f,g),!e.setProvider(c,f,i))throw y.delete(f),_&&r.delete(c),new Error("Wrong provider for target.")}return g}function h(c,f,l){var y=s(f,l,!1);return d(y)?!1:oe(y.has(c))}function k(c,f,l){var y=s(f,l,!1);if(!d(y))return y.get(c)}function m(c,f,l,y){var _=s(l,y,!0);_.set(c,f)}function p(c,f){var l=[],y=s(c,f,!1);if(d(y))return l;for(var _=y.keys(),g=ce(_),M=0;;){var de=le(g);if(!de)return l.length=M,l;var Ae=fe(de);try{l[M]=Ae}catch(xe){try{he(g)}finally{throw xe}}M++}}function u(c,f,l){var y=s(f,l,!1);if(d(y)||!y.delete(c))return!1;if(y.size===0){var _=r.get(f);d(_)||(_.delete(l),_.size===0&&r.delete(_))}return!0}}function Te(e){var r=e.defineMetadata,i=e.hasOwnMetadata,s=e.getOwnMetadata,h=e.getOwnMetadataKeys,k=e.deleteMetadata,m=new K,p={isProviderFor:function(u,c){var f=m.get(u);return!d(f)&&f.has(c)?!0:h(u,c).length?(d(f)&&(f=new W,m.set(u,f)),f.add(c),!0):!1},OrdinaryDefineOwnMetadata:r,OrdinaryHasOwnMetadata:i,OrdinaryGetOwnMetadata:s,OrdinaryOwnMetadataKeys:h,OrdinaryDeleteMetadata:k};return p}function D(e,r,i){var s=V.getProvider(e,r);if(!d(s))return s;if(i){if(V.setProvider(e,r,J))return J;throw new Error("Illegal state.")}}function Ie(){var e={},r=[],i=function(){function p(u,c,f){this._index=0,this._keys=u,this._values=c,this._selector=f}return p.prototype["@@iterator"]=function(){return this},p.prototype[O]=function(){return this},p.prototype.next=function(){var u=this._index;if(u>=0&&u<this._keys.length){var c=this._selector(this._keys[u],this._values[u]);return u+1>=this._keys.length?(this._index=-1,this._keys=r,this._values=r):this._index++,{value:c,done:!1}}return{value:void 0,done:!0}},p.prototype.throw=function(u){throw this._index>=0&&(this._index=-1,this._keys=r,this._values=r),u},p.prototype.return=function(u){return this._index>=0&&(this._index=-1,this._keys=r,this._values=r),{value:u,done:!0}},p}(),s=function(){function p(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(p.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),p.prototype.has=function(u){return this._find(u,!1)>=0},p.prototype.get=function(u){var c=this._find(u,!1);return c>=0?this._values[c]:void 0},p.prototype.set=function(u,c){var f=this._find(u,!0);return this._values[f]=c,this},p.prototype.delete=function(u){var c=this._find(u,!1);if(c>=0){for(var f=this._keys.length,l=c+1;l<f;l++)this._keys[l-1]=this._keys[l],this._values[l-1]=this._values[l];return this._keys.length--,this._values.length--,H(u,this._cacheKey)&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},p.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},p.prototype.keys=function(){return new i(this._keys,this._values,h)},p.prototype.values=function(){return new i(this._keys,this._values,k)},p.prototype.entries=function(){return new i(this._keys,this._values,m)},p.prototype["@@iterator"]=function(){return this.entries()},p.prototype[O]=function(){return this.entries()},p.prototype._find=function(u,c){if(!H(this._cacheKey,u)){this._cacheIndex=-1;for(var f=0;f<this._keys.length;f++)if(H(this._keys[f],u)){this._cacheIndex=f;break}}return this._cacheIndex<0&&c&&(this._cacheIndex=this._keys.length,this._keys.push(u),this._values.push(void 0)),this._cacheIndex},p}();return s;function h(p,u){return p}function k(p,u){return u}function m(p,u){return[p,u]}}function Pe(){var e=function(){function r(){this._map=new $}return Object.defineProperty(r.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),r.prototype.has=function(i){return this._map.has(i)},r.prototype.add=function(i){return this._map.set(i,i),this},r.prototype.delete=function(i){return this._map.delete(i)},r.prototype.clear=function(){this._map.clear()},r.prototype.keys=function(){return this._map.keys()},r.prototype.values=function(){return this._map.keys()},r.prototype.entries=function(){return this._map.entries()},r.prototype["@@iterator"]=function(){return this.keys()},r.prototype[O]=function(){return this.keys()},r}();return e}function Re(){var e=16,r=T.create(),i=s();return function(){function u(){this._key=s()}return u.prototype.has=function(c){var f=h(c,!1);return f!==void 0?T.has(f,this._key):!1},u.prototype.get=function(c){var f=h(c,!1);return f!==void 0?T.get(f,this._key):void 0},u.prototype.set=function(c,f){var l=h(c,!0);return l[this._key]=f,this},u.prototype.delete=function(c){var f=h(c,!1);return f!==void 0?delete f[this._key]:!1},u.prototype.clear=function(){this._key=s()},u}();function s(){var u;do u="@@WeakMap@@"+p();while(T.has(r,u));return r[u]=!0,u}function h(u,c){if(!w.call(u,i)){if(!c)return;Object.defineProperty(u,i,{value:T.create()})}return u[i]}function k(u,c){for(var f=0;f<c;++f)u[f]=Math.random()*255|0;return u}function m(u){if(typeof Uint8Array=="function"){var c=new Uint8Array(u);return typeof crypto<"u"?crypto.getRandomValues(c):typeof msCrypto<"u"?msCrypto.getRandomValues(c):k(c,u),c}return k(new Array(u),u)}function p(){var u=m(e);u[6]=u[6]&79|64,u[8]=u[8]&191|128;for(var c="",f=0;f<e;++f){var l=u[f];(f===4||f===6||f===8)&&(c+="-"),l<16&&(c+="0"),c+=l.toString(16).toLowerCase()}return c}}function L(e){return e.__=void 0,delete e.__,e}})}(n||(n={})),Lt}an();var sn=Object.defineProperty,un=(n,t,o)=>t in n?sn(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,He=(n,t,o)=>un(n,typeof t!="symbol"?t+"":t,o);let cn=class{constructor(t,o){He(this,"_target"),He(this,"_key"),He(this,"_oldValue"),He(this,"_wasDefined",!1),He(this,"_isSwapped",!1),this._target=t,this._key=o,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}};const fn={onlyIfNotExists:!0,isFactory:!1};let Gt=class{constructor(t,o,a={}){if(ot(this,"_installedInstances",new Map),ot(this,"_path"),ot(this,"_targetValue"),ot(this,"_options"),this._path=t.split("."),this._path.length===0)throw new Error("Path must not be empty");this._targetValue=o,this._options={...fn,...a}}_getTargetObject(t){let o=t;for(const a of this._path.slice(0,this._path.length-1))o[a]||(o[a]={}),o=o[a];return o}_createSwapper(t){const o=this._getTargetObject(t);return new cn(o,this._path.at(-1))}install({sdk:t,...o}){if(this._installedInstances.has(t))return;const a=this._createSwapper(t);if(!(a.value&&this._options.onlyIfNotExists)){if(this._options.isFactory&&typeof this._targetValue=="function"){const w=this._targetValue({sdk:t,...o});a.swap(w)}else a.swap(this._targetValue);this._installedInstances.set(t,a)}}uninstall({sdk:t}){const o=this._installedInstances.get(t);o&&(o.restore(),this._installedInstances.delete(t))}};var ln=Object.defineProperty,hn=(n,t,o)=>t in n?ln(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,Ue=(n,t,o)=>hn(n,typeof t!="symbol"?t+"":t,o);let dn=class{constructor(t,o){Ue(this,"_target"),Ue(this,"_key"),Ue(this,"_oldValue"),Ue(this,"_wasDefined",!1),Ue(this,"_isSwapped",!1),this._target=t,this._key=o,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}};function wt(){return"unsafeWindow"in window?window.unsafeWindow:window}var pn=Object.defineProperty,yn=(n,t,o)=>t in n?pn(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,Bt=(n,t,o)=>yn(n,typeof t!="symbol"?t+"":t,o);function Le(){return"unsafeWindow"in window?window.unsafeWindow:window}var wn=Object.defineProperty,_n=(n,t,o)=>t in n?wn(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,De=(n,t,o)=>_n(n,typeof t!="symbol"?t+"":t,o);let vn=class{constructor(t,o){De(this,"_target"),De(this,"_key"),De(this,"_oldValue"),De(this,"_wasDefined",!1),De(this,"_isSwapped",!1),this._target=t,this._key=o,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}},gn=class{constructor(t,o,a){De(this,"_enabled",!1),De(this,"_fnSwapper"),De(this,"_interceptionFunction"),De(this,"_middlewares",[]),this._fnSwapper=new vn(t,o),this._interceptionFunction=a}get enabled(){return this._fnSwapper.isSwapped&&this._enabled}disable(){this._enabled=!1,this.enabled}restore(){this._fnSwapper.restore()}enable(){this._enabled=!0,this._fnSwapper.isSwapped||this.swapToInterceptor()}swapToInterceptor(){const t=this;this._fnSwapper.swap(function(...o){if(!t._enabled)return t.callOriginalInvocator(...o);const a=t.runMiddlewares(o);if(a){if("output"in a)return a.output;"input"in a&&(o=a.input)}return t._interceptionFunction.call(this,t.getOriginalInvocator(this),...o)})}getOriginalInvocator(t){return this._fnSwapper.originalValue.bind(t??this._fnSwapper.target)}callOriginalInvocator(...t){return this.getOriginalInvocator()(...t)}runMiddlewares(t){for(const o of this._middlewares){const a=o(...t);if(a){if("output"in a)return a;"input"in a&&(t=a.input)}}return{input:t}}registerMiddleware(t){this._middlewares.push(t)}},bn=class{constructor(t){Bt(this,"_fetchInterceptor"),Bt(this,"_interceptionFilters",new Set),this._fetchInterceptor=new gn(t,"fetch",(o,a,w)=>{for(const v of this._interceptionFilters)if(v.shouldIntercept(a,w))return this.shouldKeepFilter(v,a,w)||this.removeInterceptionFilter(v),v.intercept(a,w);return o(a,w)})}enable(){this._fetchInterceptor.enable()}disable(){this._fetchInterceptor.disable()}addInterceptionFilter(t){this.enable(),this._interceptionFilters.add(t)}removeInterceptionFilter(t){this._interceptionFilters.delete(t)}shouldKeepFilter(t,o,a){return typeof t.shouldKeep=="function"?t.shouldKeep(o,a):typeof t.shouldKeep=="boolean"?t.shouldKeep:!1}};function mn(n){return n=n instanceof URL?n:new URL(n,Le().location.href),t=>typeof t=="string"?new URL(t,Le().location.href).pathname===n.pathname:t instanceof URL?t.pathname===n.pathname:new URL(t.url,Le().location.href).pathname===new URL(n,Le().location.href).pathname}function kn(n,t,o){const a=new Response(t,o),w=new URL(n,location.toString());return Object.defineProperty(a,"url",{value:w}),a}function On(n,t){const o=JSON.stringify(t),a=new Headers({"Content-Type":"application/json"});return kn(n,o,{headers:a})}const Sn=new bn(Le());function Mn(n){return!("descartesHttpClient"in n)&&"createAbortController"in n&&typeof n.createAbortController=="function"}function En(){const n=wt().W.controller.descartesClient,t=Mn(n)?n:n.descartesHttpClient,o=new dn(t,"createAbortController");o.swap(()=>(o.restore(),new AbortController))}function jn(n){const t=wt();return En(),t.W.controller.descartesClient.getFeatures([0,0,0,0],{[n]:!0},{})}async function Tn(n,t){const o=wt().W.Config.paths.features;Sn.addInterceptionFilter({shouldIntercept:mn(o),intercept(){return Promise.resolve(On(o,{[n]:{objects:[t]}}))}});const{[n]:a}=await jn(n),[w]=a.objects;return w.constructor}function In(n,t,o={}){const a={type:"Feature"};return(o.id===0||o.id)&&(a.id=o.id),o.bbox&&(a.bbox=o.bbox),a.properties={},a.geometry=n,a}function Pn(n,t,o={}){if(!n)throw new Error("coordinates is required");if(!Array.isArray(n))throw new Error("coordinates must be an Array");if(n.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Jt(n[0])||!Jt(n[1]))throw new Error("coordinates must contain numbers");return In({type:"Point",coordinates:n},t,o)}function Jt(n){return!isNaN(n)&&n!==null&&!Array.isArray(n)}function qe(){return"unsafeWindow"in window?window.unsafeWindow:window}function Rn(n){const t=qe().require("Waze/Action/CreateObject");return new t(n)}function An(n){qe().W.model.actionManager.add(Rn(n))}function xn(n){return n.toISOString().slice(0,16).replace("T"," ")}function $n(n){return qe().W.model.mapComments.getObjectById(n)}function Dn(n,t){const o=qe().require("Waze/Action/UpdateObject");return new o(n,t)}function Fn(n,t){qe().W.model.actionManager.add(Dn(n,t))}let _t;function Vn(){if(!_t)throw new Error("MapComment not initialized. Make sure to await the enhancedSDK function before using it.")}const Cn=[{async install(){_t=await Tn("mapComments",{geometry:Pn([0,0]).geometry})}},new Gt("DataModel.MapComments.addMapComment",n=>{Vn();const t=new _t({geoJSONGeometry:n.geometry,subject:n.subject,body:n.body,lockRank:n.lockRank,endDate:n.endDate?xn(n.endDate):null});return An(t),t.getID()}),new Gt("DataModel.MapComments.updateMapComment",({sdkInstance:n})=>t=>{const o=$n(t.mapCommentId);if(!o)throw new n.Errors.DataModelNotFoundError("mapComment",t.mapCommentId);const a={};t.geometry&&(a.geoJSONGeometry=t.geometry),t.subject&&(a.subject=t.subject),t.body&&(a.body=t.body),t.lockRank&&(a.lockRank=t.lockRank),Fn(o,a)},{isFactory:!0})];var zn=Object.defineProperty,Kn=(n,t,o)=>t in n?zn(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,at=(n,t,o)=>Kn(n,typeof t!="symbol"?t+"":t,o),Zt=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Yt={};/*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0

  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.

  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** */var Qt;function Wn(){if(Qt)return Yt;Qt=1;var n;return function(t){(function(o){var a=typeof globalThis=="object"?globalThis:typeof Zt=="object"?Zt:typeof self=="object"?self:typeof this=="object"?this:E(),w=v(t);typeof a.Reflect<"u"&&(w=v(a.Reflect,w)),o(w,a),typeof a.Reflect>"u"&&(a.Reflect=t);function v(P,I){return function(T,x){Object.defineProperty(P,T,{configurable:!0,writable:!0,value:x}),I&&I(T,x)}}function S(){try{return Function("return this;")()}catch{}}function O(){try{return(0,eval)("(function() { return this; })()")}catch{}}function E(){return S()||O()}})(function(o,a){var w=Object.prototype.hasOwnProperty,v=typeof Symbol=="function",S=v&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",O=v&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",E=typeof Object.create=="function",P={__proto__:[]}instanceof Array,I=!E&&!P,T={create:E?function(){return L(Object.create(null))}:P?function(){return L({__proto__:null})}:function(){return L({})},has:I?function(e,r){return w.call(e,r)}:function(e,r){return r in e},get:I?function(e,r){return w.call(e,r)?e[r]:void 0}:function(e,r){return e[r]}},x=Object.getPrototypeOf(Function),$=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Ie(),W=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Pe(),K=typeof WeakMap=="function"?WeakMap:Re(),R=v?Symbol.for("@reflect-metadata:registry"):void 0,V=Ee(),J=je(V);function we(e,r,i,s){if(d(i)){if(!ae(e))throw new TypeError;if(!se(r))throw new TypeError;return ve(e,r)}else{if(!ae(e))throw new TypeError;if(!b(r))throw new TypeError;if(!b(s)&&!d(s)&&!A(s))throw new TypeError;return A(s)&&(s=void 0),i=j(i),ge(e,r,i,s)}}o("decorate",we);function F(e,r){function i(s,h){if(!b(s))throw new TypeError;if(!d(h)&&!Se(h))throw new TypeError;te(e,r,s,h)}return i}o("metadata",F);function C(e,r,i,s){if(!b(i))throw new TypeError;return d(s)||(s=j(s)),te(e,r,i,s)}o("defineMetadata",C);function q(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=j(i)),Q(e,r,i)}o("hasMetadata",q);function G(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=j(i)),N(e,r,i)}o("hasOwnMetadata",G);function ye(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=j(i)),X(e,r,i)}o("getMetadata",ye);function Z(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=j(i)),ee(e,r,i)}o("getOwnMetadata",Z);function Y(e,r){if(!b(e))throw new TypeError;return d(r)||(r=j(r)),re(e,r)}o("getMetadataKeys",Y);function pe(e,r){if(!b(e))throw new TypeError;return d(r)||(r=j(r)),ne(e,r)}o("getOwnMetadataKeys",pe);function _e(e,r,i){if(!b(r))throw new TypeError;if(d(i)||(i=j(i)),!b(r))throw new TypeError;d(i)||(i=j(i));var s=D(r,i,!1);return d(s)?!1:s.OrdinaryDeleteMetadata(e,r,i)}o("deleteMetadata",_e);function ve(e,r){for(var i=e.length-1;i>=0;--i){var s=e[i],h=s(r);if(!d(h)&&!A(h)){if(!se(h))throw new TypeError;r=h}}return r}function ge(e,r,i,s){for(var h=e.length-1;h>=0;--h){var k=e[h],m=k(r,i,s);if(!d(m)&&!A(m)){if(!b(m))throw new TypeError;s=m}}return s}function Q(e,r,i){var s=N(e,r,i);if(s)return!0;var h=U(r);return A(h)?!1:Q(e,h,i)}function N(e,r,i){var s=D(r,i,!1);return d(s)?!1:oe(s.OrdinaryHasOwnMetadata(e,r,i))}function X(e,r,i){var s=N(e,r,i);if(s)return ee(e,r,i);var h=U(r);if(!A(h))return X(e,h,i)}function ee(e,r,i){var s=D(r,i,!1);if(!d(s))return s.OrdinaryGetOwnMetadata(e,r,i)}function te(e,r,i,s){var h=D(i,s,!0);h.OrdinaryDefineOwnMetadata(e,r,i,s)}function re(e,r){var i=ne(e,r),s=U(e);if(s===null)return i;var h=re(s,r);if(h.length<=0)return i;if(i.length<=0)return h;for(var k=new W,m=[],p=0,u=i;p<u.length;p++){var c=u[p],f=k.has(c);f||(k.add(c),m.push(c))}for(var l=0,y=h;l<y.length;l++){var c=y[l],f=k.has(c);f||(k.add(c),m.push(c))}return m}function ne(e,r){var i=D(e,r,!1);return i?i.OrdinaryOwnMetadataKeys(e,r):[]}function ie(e){if(e===null)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return e===null?1:6;default:return 6}}function d(e){return e===void 0}function A(e){return e===null}function be(e){return typeof e=="symbol"}function b(e){return typeof e=="object"?e!==null:typeof e=="function"}function me(e,r){switch(ie(e)){case 0:return e;case 1:return e;case 2:return e;case 3:return e;case 4:return e;case 5:return e}var i="string",s=ue(e,S);if(s!==void 0){var h=s.call(e,i);if(b(h))throw new TypeError;return h}return ke(e)}function ke(e,r){var i,s;{var h=e.toString;if(z(h)){var s=h.call(e);if(!b(s))return s}var i=e.valueOf;if(z(i)){var s=i.call(e);if(!b(s))return s}}throw new TypeError}function oe(e){return!!e}function Oe(e){return""+e}function j(e){var r=me(e);return be(r)?r:Oe(r)}function ae(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:Object.prototype.toString.call(e)==="[object Array]"}function z(e){return typeof e=="function"}function se(e){return typeof e=="function"}function Se(e){switch(ie(e)){case 3:return!0;case 4:return!0;default:return!1}}function H(e,r){return e===r||e!==e&&r!==r}function ue(e,r){var i=e[r];if(i!=null){if(!z(i))throw new TypeError;return i}}function ce(e){var r=ue(e,O);if(!z(r))throw new TypeError;var i=r.call(e);if(!b(i))throw new TypeError;return i}function fe(e){return e.value}function le(e){var r=e.next();return r.done?!1:r}function he(e){var r=e.return;r&&r.call(e)}function U(e){var r=Object.getPrototypeOf(e);if(typeof e!="function"||e===x||r!==x)return r;var i=e.prototype,s=i&&Object.getPrototypeOf(i);if(s==null||s===Object.prototype)return r;var h=s.constructor;return typeof h!="function"||h===e?r:h}function Me(){var e;!d(R)&&typeof a.Reflect<"u"&&!(R in a.Reflect)&&typeof a.Reflect.defineMetadata=="function"&&(e=Te(a.Reflect));var r,i,s,h=new K,k={registerProvider:m,getProvider:u,setProvider:f};return k;function m(l){if(!Object.isExtensible(k))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case e===l:break;case d(r):r=l;break;case r===l:break;case d(i):i=l;break;case i===l:break;default:s===void 0&&(s=new W),s.add(l);break}}function p(l,y){if(!d(r)){if(r.isProviderFor(l,y))return r;if(!d(i)){if(i.isProviderFor(l,y))return r;if(!d(s))for(var _=ce(s);;){var g=le(_);if(!g)return;var M=fe(g);if(M.isProviderFor(l,y))return he(_),M}}}if(!d(e)&&e.isProviderFor(l,y))return e}function u(l,y){var _=h.get(l),g;return d(_)||(g=_.get(y)),d(g)&&(g=p(l,y),d(g)||(d(_)&&(_=new $,h.set(l,_)),_.set(y,g))),g}function c(l){if(d(l))throw new TypeError;return r===l||i===l||!d(s)&&s.has(l)}function f(l,y,_){if(!c(_))throw new Error("Metadata provider not registered.");var g=u(l,y);if(g!==_){if(!d(g))return!1;var M=h.get(l);d(M)&&(M=new $,h.set(l,M)),M.set(y,_)}return!0}}function Ee(){var e;return!d(R)&&b(a.Reflect)&&Object.isExtensible(a.Reflect)&&(e=a.Reflect[R]),d(e)&&(e=Me()),!d(R)&&b(a.Reflect)&&Object.isExtensible(a.Reflect)&&Object.defineProperty(a.Reflect,R,{enumerable:!1,configurable:!1,writable:!1,value:e}),e}function je(e){var r=new K,i={isProviderFor:function(c,f){var l=r.get(c);return d(l)?!1:l.has(f)},OrdinaryDefineOwnMetadata:m,OrdinaryHasOwnMetadata:h,OrdinaryGetOwnMetadata:k,OrdinaryOwnMetadataKeys:p,OrdinaryDeleteMetadata:u};return V.registerProvider(i),i;function s(c,f,l){var y=r.get(c),_=!1;if(d(y)){if(!l)return;y=new $,r.set(c,y),_=!0}var g=y.get(f);if(d(g)){if(!l)return;if(g=new $,y.set(f,g),!e.setProvider(c,f,i))throw y.delete(f),_&&r.delete(c),new Error("Wrong provider for target.")}return g}function h(c,f,l){var y=s(f,l,!1);return d(y)?!1:oe(y.has(c))}function k(c,f,l){var y=s(f,l,!1);if(!d(y))return y.get(c)}function m(c,f,l,y){var _=s(l,y,!0);_.set(c,f)}function p(c,f){var l=[],y=s(c,f,!1);if(d(y))return l;for(var _=y.keys(),g=ce(_),M=0;;){var de=le(g);if(!de)return l.length=M,l;var Ae=fe(de);try{l[M]=Ae}catch(xe){try{he(g)}finally{throw xe}}M++}}function u(c,f,l){var y=s(f,l,!1);if(d(y)||!y.delete(c))return!1;if(y.size===0){var _=r.get(f);d(_)||(_.delete(l),_.size===0&&r.delete(_))}return!0}}function Te(e){var r=e.defineMetadata,i=e.hasOwnMetadata,s=e.getOwnMetadata,h=e.getOwnMetadataKeys,k=e.deleteMetadata,m=new K,p={isProviderFor:function(u,c){var f=m.get(u);return!d(f)&&f.has(c)?!0:h(u,c).length?(d(f)&&(f=new W,m.set(u,f)),f.add(c),!0):!1},OrdinaryDefineOwnMetadata:r,OrdinaryHasOwnMetadata:i,OrdinaryGetOwnMetadata:s,OrdinaryOwnMetadataKeys:h,OrdinaryDeleteMetadata:k};return p}function D(e,r,i){var s=V.getProvider(e,r);if(!d(s))return s;if(i){if(V.setProvider(e,r,J))return J;throw new Error("Illegal state.")}}function Ie(){var e={},r=[],i=function(){function p(u,c,f){this._index=0,this._keys=u,this._values=c,this._selector=f}return p.prototype["@@iterator"]=function(){return this},p.prototype[O]=function(){return this},p.prototype.next=function(){var u=this._index;if(u>=0&&u<this._keys.length){var c=this._selector(this._keys[u],this._values[u]);return u+1>=this._keys.length?(this._index=-1,this._keys=r,this._values=r):this._index++,{value:c,done:!1}}return{value:void 0,done:!0}},p.prototype.throw=function(u){throw this._index>=0&&(this._index=-1,this._keys=r,this._values=r),u},p.prototype.return=function(u){return this._index>=0&&(this._index=-1,this._keys=r,this._values=r),{value:u,done:!0}},p}(),s=function(){function p(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(p.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),p.prototype.has=function(u){return this._find(u,!1)>=0},p.prototype.get=function(u){var c=this._find(u,!1);return c>=0?this._values[c]:void 0},p.prototype.set=function(u,c){var f=this._find(u,!0);return this._values[f]=c,this},p.prototype.delete=function(u){var c=this._find(u,!1);if(c>=0){for(var f=this._keys.length,l=c+1;l<f;l++)this._keys[l-1]=this._keys[l],this._values[l-1]=this._values[l];return this._keys.length--,this._values.length--,H(u,this._cacheKey)&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},p.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},p.prototype.keys=function(){return new i(this._keys,this._values,h)},p.prototype.values=function(){return new i(this._keys,this._values,k)},p.prototype.entries=function(){return new i(this._keys,this._values,m)},p.prototype["@@iterator"]=function(){return this.entries()},p.prototype[O]=function(){return this.entries()},p.prototype._find=function(u,c){if(!H(this._cacheKey,u)){this._cacheIndex=-1;for(var f=0;f<this._keys.length;f++)if(H(this._keys[f],u)){this._cacheIndex=f;break}}return this._cacheIndex<0&&c&&(this._cacheIndex=this._keys.length,this._keys.push(u),this._values.push(void 0)),this._cacheIndex},p}();return s;function h(p,u){return p}function k(p,u){return u}function m(p,u){return[p,u]}}function Pe(){var e=function(){function r(){this._map=new $}return Object.defineProperty(r.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),r.prototype.has=function(i){return this._map.has(i)},r.prototype.add=function(i){return this._map.set(i,i),this},r.prototype.delete=function(i){return this._map.delete(i)},r.prototype.clear=function(){this._map.clear()},r.prototype.keys=function(){return this._map.keys()},r.prototype.values=function(){return this._map.keys()},r.prototype.entries=function(){return this._map.entries()},r.prototype["@@iterator"]=function(){return this.keys()},r.prototype[O]=function(){return this.keys()},r}();return e}function Re(){var e=16,r=T.create(),i=s();return function(){function u(){this._key=s()}return u.prototype.has=function(c){var f=h(c,!1);return f!==void 0?T.has(f,this._key):!1},u.prototype.get=function(c){var f=h(c,!1);return f!==void 0?T.get(f,this._key):void 0},u.prototype.set=function(c,f){var l=h(c,!0);return l[this._key]=f,this},u.prototype.delete=function(c){var f=h(c,!1);return f!==void 0?delete f[this._key]:!1},u.prototype.clear=function(){this._key=s()},u}();function s(){var u;do u="@@WeakMap@@"+p();while(T.has(r,u));return r[u]=!0,u}function h(u,c){if(!w.call(u,i)){if(!c)return;Object.defineProperty(u,i,{value:T.create()})}return u[i]}function k(u,c){for(var f=0;f<c;++f)u[f]=Math.random()*255|0;return u}function m(u){if(typeof Uint8Array=="function"){var c=new Uint8Array(u);return typeof crypto<"u"?crypto.getRandomValues(c):typeof msCrypto<"u"?msCrypto.getRandomValues(c):k(c,u),c}return k(new Array(u),u)}function p(){var u=m(e);u[6]=u[6]&79|64,u[8]=u[8]&191|128;for(var c="",f=0;f<e;++f){var l=u[f];(f===4||f===6||f===8)&&(c+="-"),l<16&&(c+="0"),c+=l.toString(16).toLowerCase()}return c}}function L(e){return e.__=void 0,delete e.__,e}})}(n||(n={})),Yt}Wn();var Nn=Object.defineProperty,Hn=(n,t,o)=>t in n?Nn(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,Ge=(n,t,o)=>Hn(n,typeof t!="symbol"?t+"":t,o);let Un=class{constructor(t,o){Ge(this,"_target"),Ge(this,"_key"),Ge(this,"_oldValue"),Ge(this,"_wasDefined",!1),Ge(this,"_isSwapped",!1),this._target=t,this._key=o,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}};const Ln={onlyIfNotExists:!0,isFactory:!1};class vt{constructor(t,o,a={}){if(at(this,"_installedInstances",new Map),at(this,"_path"),at(this,"_targetValue"),at(this,"_options"),this._path=t.split("."),this._path.length===0)throw new Error("Path must not be empty");this._targetValue=o,this._options={...Ln,...a}}_getTargetObject(t){let o=t;for(const a of this._path.slice(0,this._path.length-1))o[a]||(o[a]={}),o=o[a];return o}_createSwapper(t){const o=this._getTargetObject(t);return new Un(o,this._path.at(-1))}install({sdk:t,...o}){if(this._installedInstances.has(t))return;const a=this._createSwapper(t);if(!(a.value&&this._options.onlyIfNotExists)){if(this._options.isFactory&&typeof this._targetValue=="function"){const w=this._targetValue({sdk:t,...o});a.swap(w)}else a.swap(this._targetValue);this._installedInstances.set(t,a)}}uninstall({sdk:t}){const o=this._installedInstances.get(t);o&&(o.restore(),this._installedInstances.delete(t))}}var qn=Object.defineProperty,Gn=(n,t,o)=>t in n?qn(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,Be=(n,t,o)=>Gn(n,typeof t!="symbol"?t+"":t,o);let Xt=class{constructor(n,t){Be(this,"_target"),Be(this,"_key"),Be(this,"_oldValue"),Be(this,"_wasDefined",!1),Be(this,"_isSwapped",!1),this._target=n,this._key=t,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(n){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=n,this._isSwapped=!0}};function gt(){return"unsafeWindow"in window?window.unsafeWindow:window}async function Bn(n){const t=[],o=new Xt(gt().W.model.actionManager,"add");o.swap(a=>{t.push(a)});try{await n()}finally{o.restore()}return t}function Jn(n){return n.memoizedProps||{}}function Zn(n){return typeof n=="object"&&n!==null&&"memoizedState"in n&&Array.isArray(n.memoizedState)&&n.memoizedState.length===2&&"queue"in n&&n.queue===null&&Array.isArray(n.memoizedState[1])}function Yn(n){return typeof n=="object"&&n!==null&&"memoizedState"in n&&typeof n.memoizedState=="object"&&n.memoizedState!==null&&"current"in n.memoizedState&&"queue"in n&&n.queue===null}function Qn(n){return typeof n=="object"&&n!==null&&"memoizedState"in n&&"queue"in n&&typeof n.queue=="object"&&n.queue!==null&&"dispatch"in n.queue&&typeof n.queue.dispatch=="function"}function Xn(n){return Qn(n)?{type:"useState",value:n.memoizedState,dispatch:n.queue.dispatch}:Zn(n)?{type:"useMemo",value:n.memoizedState[0],dependencies:n.memoizedState[1]}:Yn(n)?{type:"useRef",current:n.memoizedState}:null}function ei(n,t){const o=[];let a=n.memoizedState;for(;a;){const w=Xn(a);w&&o.push(w),a=a.next}return o}function ti(n,t,o=1/0){let a=n,w=0;for(;a&&w<o;){const v=a.memoizedState?ei(a):[],S=Jn(a),O={fiber:a,hooks:{all:v,useState:v.filter(E=>E.type==="useState"),useMemo:v.filter(E=>E.type==="useMemo"),useRef:v.filter(E=>E.type==="useRef")},props:S};if(t(O))return O;a=a.return,w++}return null}const ri="__reactFiber$";function ni(n){const t=Object.keys(n).find(a=>a.startsWith(ri));if(!t)throw new Error(`No fiber key found for element: ${n}`);const o=n[t];if(!o)throw new Error(`No fiber found for element: ${n}`);return o}const ii=n=>new Promise(t=>{const o=gt(),a=new Xt(o.W.map.olMap,"addControl");a.swap(w=>{n==null||n(w),t(w),a.restore()})});function oi(n){const t=gt(),o=t.W.userscripts.toOLGeometry(n);return new t.OpenLayers.Feature.Vector(o)}async function ai(n,t){const o=ti(ni(n),v=>"onClick"in v.props&&typeof v.props.onClick=="function");if(!o)throw new Error("No fiber found with draw initiator");const{onClick:a}=o.props;//! OpenLayers dependent code below - implementation might change over time
const w=ii(v=>{v.activate=()=>{}});a(new Event("click")),(await w).events.triggerEvent("featureadded",{feature:oi(t)})}var si=Object.defineProperty,ui=(n,t,o)=>t in n?si(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,er=(n,t,o)=>ui(n,typeof t!="symbol"?t+"":t,o);function ci(){return"unsafeWindow"in window?window.unsafeWindow:window}var fi=Object.defineProperty,li=(n,t,o)=>t in n?fi(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,Fe=(n,t,o)=>li(n,typeof t!="symbol"?t+"":t,o);let hi=class{constructor(t,o){Fe(this,"_target"),Fe(this,"_key"),Fe(this,"_oldValue"),Fe(this,"_wasDefined",!1),Fe(this,"_isSwapped",!1),this._target=t,this._key=o,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}},di=class{constructor(t,o,a){Fe(this,"_enabled",!1),Fe(this,"_fnSwapper"),Fe(this,"_interceptionFunction"),Fe(this,"_middlewares",[]),this._fnSwapper=new hi(t,o),this._interceptionFunction=a}get enabled(){return this._fnSwapper.isSwapped&&this._enabled}disable(){this._enabled=!1,this.enabled}restore(){this._fnSwapper.restore()}enable(){this._enabled=!0,this._fnSwapper.isSwapped||this.swapToInterceptor()}swapToInterceptor(){const t=this;this._fnSwapper.swap(function(...o){if(!t._enabled)return t.callOriginalInvocator(...o);const a=t.runMiddlewares(o);if(a){if("output"in a)return a.output;"input"in a&&(o=a.input)}return t._interceptionFunction.call(this,t.getOriginalInvocator(this),...o)})}getOriginalInvocator(t){return this._fnSwapper.originalValue.bind(t??this._fnSwapper.target)}callOriginalInvocator(...t){return this.getOriginalInvocator()(...t)}runMiddlewares(t){for(const o of this._middlewares){const a=o(...t);if(a){if("output"in a)return a;"input"in a&&(t=a.input)}}return{input:t}}registerMiddleware(t){this._middlewares.push(t)}},pi=class{constructor(t){er(this,"_fetchInterceptor"),er(this,"_interceptionFilters",new Set),this._fetchInterceptor=new di(t,"fetch",(o,a,w)=>{for(const v of this._interceptionFilters)if(v.shouldIntercept(a,w))return this.shouldKeepFilter(v,a,w)||this.removeInterceptionFilter(v),v.intercept(a,w);return o(a,w)})}enable(){this._fetchInterceptor.enable()}disable(){this._fetchInterceptor.disable()}addInterceptionFilter(t){this.enable(),this._interceptionFilters.add(t)}removeInterceptionFilter(t){this._interceptionFilters.delete(t)}shouldKeepFilter(t,o,a){return typeof t.shouldKeep=="function"?t.shouldKeep(o,a):typeof t.shouldKeep=="boolean"?t.shouldKeep:!1}};new pi(ci());function yi(n,t,o={}){const a={type:"Feature"};return(o.id===0||o.id)&&(a.id=o.id),o.bbox&&(a.bbox=o.bbox),a.properties={},a.geometry=n,a}function wi(n,t,o={}){for(const a of n){if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(a[a.length-1].length!==a[0].length)throw new Error("First and last Position are not equivalent.");for(let w=0;w<a[a.length-1].length;w++)if(a[a.length-1][w]!==a[0][w])throw new Error("First and last Position are not equivalent.")}return yi({type:"Polygon",coordinates:n},t,o)}function st(){return"unsafeWindow"in window?window.unsafeWindow:window}function _i(n,t,o){const a=new n(o),w=new t(a);return st().W.model.actionManager.add(w),a}function tr(n){return st().W.model.permanentHazards.getObjectById(n)}function vi(n,t){const o=st().require("Waze/Action/UpdateObject");return new o(n,t)}function gi(n,t){st().W.model.actionManager.add(vi(n,t))}function bi(n){return Object.fromEntries(Object.entries(n).filter(([,t])=>t!==void 0))}let bt,mt;const mi=[{async install(){const n=document.querySelector("#drawer wz-menu > wz-menu-sub-menu:nth-child(3) > wz-menu-item:nth-of-type(2)");if(!n||!(n instanceof HTMLElement))throw new Error("Unable to find school zone drawing menu item");const[t]=await Bn(async()=>{await ai(n,wi([[[0,0],[0,1],[1,1],[0,0]]]).geometry)});if(t.actionName!=="ADD_PERMANENT_HAZARD")throw new Error("Unexpected action discovered when tried to resolve AddPermanentHazard action: "+t.actionName);const o=t.object;if(!o)throw new Error("Unexpected state: Added object does not exist");if(o.type!=="permanentHazard")throw new Error("Unexpected state: Expected the added object to be a PermanentHazard instead of "+t.type);bt=t.constructor,mt=o.constructor}},new vt("DataModel.PermanentHazards.addSchoolZone",n=>{if(!mt||!bt)throw new Error("PermanentHazard or AddPermanentHazard are not initialized. Make sure to await the enhancedSDK function before using it.");return _i(mt,bt,{type:9,geoJSONGeometry:n.geometry,name:n.name,speedLimit:n.speedLimit,excludedRoadTypes:n.excludedRoadTypes}).getID()}),new vt("DataModel.PermanentHazards.updateSchoolZone",({sdkInstance:n})=>t=>{const o=tr(t.schoolZoneId);if(!o||o.getAttribute("type")!==9)throw new n.Errors.DataModelNotFoundError("permanentHazard.SchoolZone",t.schoolZoneId);gi(o,bi({geoJSONGeometry:t.geometry,name:t.name,speedLimit:t.speedLimit,excludedRoadTypes:t.excludedRoadTypes}))},{isFactory:!0}),new vt("DataModel.PermanentHazards.getSchoolZoneById",()=>n=>{const t=tr(n.schoolZoneId);return!t||t.getAttribute("type")!==9?null:t},{isFactory:!0})];var ki=Object.defineProperty,Oi=(n,t,o)=>t in n?ki(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,ut=(n,t,o)=>Oi(n,typeof t!="symbol"?t+"":t,o),rr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},nr={};/*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0

  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.

  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** */var ir;function Si(){if(ir)return nr;ir=1;var n;return function(t){(function(o){var a=typeof globalThis=="object"?globalThis:typeof rr=="object"?rr:typeof self=="object"?self:typeof this=="object"?this:E(),w=v(t);typeof a.Reflect<"u"&&(w=v(a.Reflect,w)),o(w,a),typeof a.Reflect>"u"&&(a.Reflect=t);function v(P,I){return function(T,x){Object.defineProperty(P,T,{configurable:!0,writable:!0,value:x}),I&&I(T,x)}}function S(){try{return Function("return this;")()}catch{}}function O(){try{return(0,eval)("(function() { return this; })()")}catch{}}function E(){return S()||O()}})(function(o,a){var w=Object.prototype.hasOwnProperty,v=typeof Symbol=="function",S=v&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",O=v&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",E=typeof Object.create=="function",P={__proto__:[]}instanceof Array,I=!E&&!P,T={create:E?function(){return L(Object.create(null))}:P?function(){return L({__proto__:null})}:function(){return L({})},has:I?function(e,r){return w.call(e,r)}:function(e,r){return r in e},get:I?function(e,r){return w.call(e,r)?e[r]:void 0}:function(e,r){return e[r]}},x=Object.getPrototypeOf(Function),$=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Ie(),W=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Pe(),K=typeof WeakMap=="function"?WeakMap:Re(),R=v?Symbol.for("@reflect-metadata:registry"):void 0,V=Ee(),J=je(V);function we(e,r,i,s){if(d(i)){if(!ae(e))throw new TypeError;if(!se(r))throw new TypeError;return ve(e,r)}else{if(!ae(e))throw new TypeError;if(!b(r))throw new TypeError;if(!b(s)&&!d(s)&&!A(s))throw new TypeError;return A(s)&&(s=void 0),i=j(i),ge(e,r,i,s)}}o("decorate",we);function F(e,r){function i(s,h){if(!b(s))throw new TypeError;if(!d(h)&&!Se(h))throw new TypeError;te(e,r,s,h)}return i}o("metadata",F);function C(e,r,i,s){if(!b(i))throw new TypeError;return d(s)||(s=j(s)),te(e,r,i,s)}o("defineMetadata",C);function q(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=j(i)),Q(e,r,i)}o("hasMetadata",q);function G(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=j(i)),N(e,r,i)}o("hasOwnMetadata",G);function ye(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=j(i)),X(e,r,i)}o("getMetadata",ye);function Z(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=j(i)),ee(e,r,i)}o("getOwnMetadata",Z);function Y(e,r){if(!b(e))throw new TypeError;return d(r)||(r=j(r)),re(e,r)}o("getMetadataKeys",Y);function pe(e,r){if(!b(e))throw new TypeError;return d(r)||(r=j(r)),ne(e,r)}o("getOwnMetadataKeys",pe);function _e(e,r,i){if(!b(r))throw new TypeError;if(d(i)||(i=j(i)),!b(r))throw new TypeError;d(i)||(i=j(i));var s=D(r,i,!1);return d(s)?!1:s.OrdinaryDeleteMetadata(e,r,i)}o("deleteMetadata",_e);function ve(e,r){for(var i=e.length-1;i>=0;--i){var s=e[i],h=s(r);if(!d(h)&&!A(h)){if(!se(h))throw new TypeError;r=h}}return r}function ge(e,r,i,s){for(var h=e.length-1;h>=0;--h){var k=e[h],m=k(r,i,s);if(!d(m)&&!A(m)){if(!b(m))throw new TypeError;s=m}}return s}function Q(e,r,i){var s=N(e,r,i);if(s)return!0;var h=U(r);return A(h)?!1:Q(e,h,i)}function N(e,r,i){var s=D(r,i,!1);return d(s)?!1:oe(s.OrdinaryHasOwnMetadata(e,r,i))}function X(e,r,i){var s=N(e,r,i);if(s)return ee(e,r,i);var h=U(r);if(!A(h))return X(e,h,i)}function ee(e,r,i){var s=D(r,i,!1);if(!d(s))return s.OrdinaryGetOwnMetadata(e,r,i)}function te(e,r,i,s){var h=D(i,s,!0);h.OrdinaryDefineOwnMetadata(e,r,i,s)}function re(e,r){var i=ne(e,r),s=U(e);if(s===null)return i;var h=re(s,r);if(h.length<=0)return i;if(i.length<=0)return h;for(var k=new W,m=[],p=0,u=i;p<u.length;p++){var c=u[p],f=k.has(c);f||(k.add(c),m.push(c))}for(var l=0,y=h;l<y.length;l++){var c=y[l],f=k.has(c);f||(k.add(c),m.push(c))}return m}function ne(e,r){var i=D(e,r,!1);return i?i.OrdinaryOwnMetadataKeys(e,r):[]}function ie(e){if(e===null)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return e===null?1:6;default:return 6}}function d(e){return e===void 0}function A(e){return e===null}function be(e){return typeof e=="symbol"}function b(e){return typeof e=="object"?e!==null:typeof e=="function"}function me(e,r){switch(ie(e)){case 0:return e;case 1:return e;case 2:return e;case 3:return e;case 4:return e;case 5:return e}var i="string",s=ue(e,S);if(s!==void 0){var h=s.call(e,i);if(b(h))throw new TypeError;return h}return ke(e)}function ke(e,r){var i,s;{var h=e.toString;if(z(h)){var s=h.call(e);if(!b(s))return s}var i=e.valueOf;if(z(i)){var s=i.call(e);if(!b(s))return s}}throw new TypeError}function oe(e){return!!e}function Oe(e){return""+e}function j(e){var r=me(e);return be(r)?r:Oe(r)}function ae(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:Object.prototype.toString.call(e)==="[object Array]"}function z(e){return typeof e=="function"}function se(e){return typeof e=="function"}function Se(e){switch(ie(e)){case 3:return!0;case 4:return!0;default:return!1}}function H(e,r){return e===r||e!==e&&r!==r}function ue(e,r){var i=e[r];if(i!=null){if(!z(i))throw new TypeError;return i}}function ce(e){var r=ue(e,O);if(!z(r))throw new TypeError;var i=r.call(e);if(!b(i))throw new TypeError;return i}function fe(e){return e.value}function le(e){var r=e.next();return r.done?!1:r}function he(e){var r=e.return;r&&r.call(e)}function U(e){var r=Object.getPrototypeOf(e);if(typeof e!="function"||e===x||r!==x)return r;var i=e.prototype,s=i&&Object.getPrototypeOf(i);if(s==null||s===Object.prototype)return r;var h=s.constructor;return typeof h!="function"||h===e?r:h}function Me(){var e;!d(R)&&typeof a.Reflect<"u"&&!(R in a.Reflect)&&typeof a.Reflect.defineMetadata=="function"&&(e=Te(a.Reflect));var r,i,s,h=new K,k={registerProvider:m,getProvider:u,setProvider:f};return k;function m(l){if(!Object.isExtensible(k))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case e===l:break;case d(r):r=l;break;case r===l:break;case d(i):i=l;break;case i===l:break;default:s===void 0&&(s=new W),s.add(l);break}}function p(l,y){if(!d(r)){if(r.isProviderFor(l,y))return r;if(!d(i)){if(i.isProviderFor(l,y))return r;if(!d(s))for(var _=ce(s);;){var g=le(_);if(!g)return;var M=fe(g);if(M.isProviderFor(l,y))return he(_),M}}}if(!d(e)&&e.isProviderFor(l,y))return e}function u(l,y){var _=h.get(l),g;return d(_)||(g=_.get(y)),d(g)&&(g=p(l,y),d(g)||(d(_)&&(_=new $,h.set(l,_)),_.set(y,g))),g}function c(l){if(d(l))throw new TypeError;return r===l||i===l||!d(s)&&s.has(l)}function f(l,y,_){if(!c(_))throw new Error("Metadata provider not registered.");var g=u(l,y);if(g!==_){if(!d(g))return!1;var M=h.get(l);d(M)&&(M=new $,h.set(l,M)),M.set(y,_)}return!0}}function Ee(){var e;return!d(R)&&b(a.Reflect)&&Object.isExtensible(a.Reflect)&&(e=a.Reflect[R]),d(e)&&(e=Me()),!d(R)&&b(a.Reflect)&&Object.isExtensible(a.Reflect)&&Object.defineProperty(a.Reflect,R,{enumerable:!1,configurable:!1,writable:!1,value:e}),e}function je(e){var r=new K,i={isProviderFor:function(c,f){var l=r.get(c);return d(l)?!1:l.has(f)},OrdinaryDefineOwnMetadata:m,OrdinaryHasOwnMetadata:h,OrdinaryGetOwnMetadata:k,OrdinaryOwnMetadataKeys:p,OrdinaryDeleteMetadata:u};return V.registerProvider(i),i;function s(c,f,l){var y=r.get(c),_=!1;if(d(y)){if(!l)return;y=new $,r.set(c,y),_=!0}var g=y.get(f);if(d(g)){if(!l)return;if(g=new $,y.set(f,g),!e.setProvider(c,f,i))throw y.delete(f),_&&r.delete(c),new Error("Wrong provider for target.")}return g}function h(c,f,l){var y=s(f,l,!1);return d(y)?!1:oe(y.has(c))}function k(c,f,l){var y=s(f,l,!1);if(!d(y))return y.get(c)}function m(c,f,l,y){var _=s(l,y,!0);_.set(c,f)}function p(c,f){var l=[],y=s(c,f,!1);if(d(y))return l;for(var _=y.keys(),g=ce(_),M=0;;){var de=le(g);if(!de)return l.length=M,l;var Ae=fe(de);try{l[M]=Ae}catch(xe){try{he(g)}finally{throw xe}}M++}}function u(c,f,l){var y=s(f,l,!1);if(d(y)||!y.delete(c))return!1;if(y.size===0){var _=r.get(f);d(_)||(_.delete(l),_.size===0&&r.delete(_))}return!0}}function Te(e){var r=e.defineMetadata,i=e.hasOwnMetadata,s=e.getOwnMetadata,h=e.getOwnMetadataKeys,k=e.deleteMetadata,m=new K,p={isProviderFor:function(u,c){var f=m.get(u);return!d(f)&&f.has(c)?!0:h(u,c).length?(d(f)&&(f=new W,m.set(u,f)),f.add(c),!0):!1},OrdinaryDefineOwnMetadata:r,OrdinaryHasOwnMetadata:i,OrdinaryGetOwnMetadata:s,OrdinaryOwnMetadataKeys:h,OrdinaryDeleteMetadata:k};return p}function D(e,r,i){var s=V.getProvider(e,r);if(!d(s))return s;if(i){if(V.setProvider(e,r,J))return J;throw new Error("Illegal state.")}}function Ie(){var e={},r=[],i=function(){function p(u,c,f){this._index=0,this._keys=u,this._values=c,this._selector=f}return p.prototype["@@iterator"]=function(){return this},p.prototype[O]=function(){return this},p.prototype.next=function(){var u=this._index;if(u>=0&&u<this._keys.length){var c=this._selector(this._keys[u],this._values[u]);return u+1>=this._keys.length?(this._index=-1,this._keys=r,this._values=r):this._index++,{value:c,done:!1}}return{value:void 0,done:!0}},p.prototype.throw=function(u){throw this._index>=0&&(this._index=-1,this._keys=r,this._values=r),u},p.prototype.return=function(u){return this._index>=0&&(this._index=-1,this._keys=r,this._values=r),{value:u,done:!0}},p}(),s=function(){function p(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(p.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),p.prototype.has=function(u){return this._find(u,!1)>=0},p.prototype.get=function(u){var c=this._find(u,!1);return c>=0?this._values[c]:void 0},p.prototype.set=function(u,c){var f=this._find(u,!0);return this._values[f]=c,this},p.prototype.delete=function(u){var c=this._find(u,!1);if(c>=0){for(var f=this._keys.length,l=c+1;l<f;l++)this._keys[l-1]=this._keys[l],this._values[l-1]=this._values[l];return this._keys.length--,this._values.length--,H(u,this._cacheKey)&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},p.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},p.prototype.keys=function(){return new i(this._keys,this._values,h)},p.prototype.values=function(){return new i(this._keys,this._values,k)},p.prototype.entries=function(){return new i(this._keys,this._values,m)},p.prototype["@@iterator"]=function(){return this.entries()},p.prototype[O]=function(){return this.entries()},p.prototype._find=function(u,c){if(!H(this._cacheKey,u)){this._cacheIndex=-1;for(var f=0;f<this._keys.length;f++)if(H(this._keys[f],u)){this._cacheIndex=f;break}}return this._cacheIndex<0&&c&&(this._cacheIndex=this._keys.length,this._keys.push(u),this._values.push(void 0)),this._cacheIndex},p}();return s;function h(p,u){return p}function k(p,u){return u}function m(p,u){return[p,u]}}function Pe(){var e=function(){function r(){this._map=new $}return Object.defineProperty(r.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),r.prototype.has=function(i){return this._map.has(i)},r.prototype.add=function(i){return this._map.set(i,i),this},r.prototype.delete=function(i){return this._map.delete(i)},r.prototype.clear=function(){this._map.clear()},r.prototype.keys=function(){return this._map.keys()},r.prototype.values=function(){return this._map.keys()},r.prototype.entries=function(){return this._map.entries()},r.prototype["@@iterator"]=function(){return this.keys()},r.prototype[O]=function(){return this.keys()},r}();return e}function Re(){var e=16,r=T.create(),i=s();return function(){function u(){this._key=s()}return u.prototype.has=function(c){var f=h(c,!1);return f!==void 0?T.has(f,this._key):!1},u.prototype.get=function(c){var f=h(c,!1);return f!==void 0?T.get(f,this._key):void 0},u.prototype.set=function(c,f){var l=h(c,!0);return l[this._key]=f,this},u.prototype.delete=function(c){var f=h(c,!1);return f!==void 0?delete f[this._key]:!1},u.prototype.clear=function(){this._key=s()},u}();function s(){var u;do u="@@WeakMap@@"+p();while(T.has(r,u));return r[u]=!0,u}function h(u,c){if(!w.call(u,i)){if(!c)return;Object.defineProperty(u,i,{value:T.create()})}return u[i]}function k(u,c){for(var f=0;f<c;++f)u[f]=Math.random()*255|0;return u}function m(u){if(typeof Uint8Array=="function"){var c=new Uint8Array(u);return typeof crypto<"u"?crypto.getRandomValues(c):typeof msCrypto<"u"?msCrypto.getRandomValues(c):k(c,u),c}return k(new Array(u),u)}function p(){var u=m(e);u[6]=u[6]&79|64,u[8]=u[8]&191|128;for(var c="",f=0;f<e;++f){var l=u[f];(f===4||f===6||f===8)&&(c+="-"),l<16&&(c+="0"),c+=l.toString(16).toLowerCase()}return c}}function L(e){return e.__=void 0,delete e.__,e}})}(n||(n={})),nr}Si();var Mi=Object.defineProperty,Ei=(n,t,o)=>t in n?Mi(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,Je=(n,t,o)=>Ei(n,typeof t!="symbol"?t+"":t,o);let ji=class{constructor(t,o){Je(this,"_target"),Je(this,"_key"),Je(this,"_oldValue"),Je(this,"_wasDefined",!1),Je(this,"_isSwapped",!1),this._target=t,this._key=o,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}};const Ti={onlyIfNotExists:!0,isFactory:!1};let Ii=class{constructor(t,o,a={}){if(ut(this,"_installedInstances",new Map),ut(this,"_path"),ut(this,"_targetValue"),ut(this,"_options"),this._path=t.split("."),this._path.length===0)throw new Error("Path must not be empty");this._targetValue=o,this._options={...Ti,...a}}_getTargetObject(t){let o=t;for(const a of this._path.slice(0,this._path.length-1))o[a]||(o[a]={}),o=o[a];return o}_createSwapper(t){const o=this._getTargetObject(t);return new ji(o,this._path.at(-1))}install({sdk:t,...o}){if(this._installedInstances.has(t))return;const a=this._createSwapper(t);if(!(a.value&&this._options.onlyIfNotExists)){if(this._options.isFactory&&typeof this._targetValue=="function"){const w=this._targetValue({sdk:t,...o});a.swap(w)}else a.swap(this._targetValue);this._installedInstances.set(t,a)}}uninstall({sdk:t}){const o=this._installedInstances.get(t);o&&(o.restore(),this._installedInstances.delete(t))}};const or=Symbol("BigJunction"),ar=Symbol("AddBigJunction");function Pi(){return"unsafeWindow"in window?window.unsafeWindow:window}function Ri(n,t,o){const a=new n(o),w=new t(a);return Pi().W.model.actionManager.add(w),a}const Ai=[new Ii("DataModel.BigJunctions.addBigJunction",({artifacts:n})=>t=>Ri(n[or],n[ar],{geoJSONGeometry:t.geometry}).getID(),{isFactory:!0})];function xi(n,t,o={}){const a={type:"Feature"};return(o.id===0||o.id)&&(a.id=o.id),o.bbox&&(a.bbox=o.bbox),a.properties={},a.geometry=n,a}function $i(n,t,o={}){for(const a of n){if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(a[a.length-1].length!==a[0].length)throw new Error("First and last Position are not equivalent.");for(let w=0;w<a[a.length-1].length;w++)if(a[a.length-1][w]!==a[0][w])throw new Error("First and last Position are not equivalent.")}return xi({type:"Polygon",coordinates:n},t,o)}var Di=Object.defineProperty,Fi=(n,t,o)=>t in n?Di(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,Ze=(n,t,o)=>Fi(n,typeof t!="symbol"?t+"":t,o);let sr=class{constructor(t,o){Ze(this,"_target"),Ze(this,"_key"),Ze(this,"_oldValue"),Ze(this,"_wasDefined",!1),Ze(this,"_isSwapped",!1),this._target=t,this._key=o,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}};function kt(){return"unsafeWindow"in window?window.unsafeWindow:window}async function Vi(n){const t=[],o=new sr(kt().W.model.actionManager,"add");o.swap(a=>{t.push(a)});try{await n()}finally{o.restore()}return t}function Ci(n){return n.memoizedProps||{}}function zi(n){return typeof n=="object"&&n!==null&&"memoizedState"in n&&Array.isArray(n.memoizedState)&&n.memoizedState.length===2&&"queue"in n&&n.queue===null&&Array.isArray(n.memoizedState[1])}function Ki(n){return typeof n=="object"&&n!==null&&"memoizedState"in n&&typeof n.memoizedState=="object"&&n.memoizedState!==null&&"current"in n.memoizedState&&"queue"in n&&n.queue===null}function Wi(n){return typeof n=="object"&&n!==null&&"memoizedState"in n&&"queue"in n&&typeof n.queue=="object"&&n.queue!==null&&"dispatch"in n.queue&&typeof n.queue.dispatch=="function"}function Ni(n){return Wi(n)?{type:"useState",value:n.memoizedState,dispatch:n.queue.dispatch}:zi(n)?{type:"useMemo",value:n.memoizedState[0],dependencies:n.memoizedState[1]}:Ki(n)?{type:"useRef",current:n.memoizedState}:null}function Hi(n,t){const o=[];let a=n.memoizedState;for(;a;){const w=Ni(a);w&&o.push(w),a=a.next}return o}function Ui(n,t,o=1/0){let a=n,w=0;for(;a&&w<o;){const v=a.memoizedState?Hi(a):[],S=Ci(a),O={fiber:a,hooks:{all:v,useState:v.filter(E=>E.type==="useState"),useMemo:v.filter(E=>E.type==="useMemo"),useRef:v.filter(E=>E.type==="useRef")},props:S};if(t(O))return O;a=a.return,w++}return null}const Li="__reactFiber$";function qi(n){const t=Object.keys(n).find(a=>a.startsWith(Li));if(!t)throw new Error(`No fiber key found for element: ${n}`);const o=n[t];if(!o)throw new Error(`No fiber found for element: ${n}`);return o}const Gi=n=>new Promise(t=>{const o=kt(),a=new sr(o.W.map.olMap,"addControl");a.swap(w=>{n==null||n(w),t(w),a.restore()})});function Bi(n){const t=kt(),o=t.W.userscripts.toOLGeometry(n);return new t.OpenLayers.Feature.Vector(o)}async function Ji(n,t){const o=Ui(qi(n),v=>"onClick"in v.props&&typeof v.props.onClick=="function");if(!o)throw new Error("No fiber found with draw initiator");const{onClick:a}=o.props;//! OpenLayers dependent code below - implementation might change over time
const w=Gi(v=>{v.activate=()=>{}});a(new Event("click")),(await w).events.triggerEvent("featureadded",{feature:Bi(t)})}var Zi=Object.defineProperty,Yi=(n,t,o)=>t in n?Zi(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,ur=(n,t,o)=>Yi(n,typeof t!="symbol"?t+"":t,o);function Qi(){return"unsafeWindow"in window?window.unsafeWindow:window}var Xi=Object.defineProperty,eo=(n,t,o)=>t in n?Xi(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,Ve=(n,t,o)=>eo(n,typeof t!="symbol"?t+"":t,o);let to=class{constructor(t,o){Ve(this,"_target"),Ve(this,"_key"),Ve(this,"_oldValue"),Ve(this,"_wasDefined",!1),Ve(this,"_isSwapped",!1),this._target=t,this._key=o,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}},ro=class{constructor(t,o,a){Ve(this,"_enabled",!1),Ve(this,"_fnSwapper"),Ve(this,"_interceptionFunction"),Ve(this,"_middlewares",[]),this._fnSwapper=new to(t,o),this._interceptionFunction=a}get enabled(){return this._fnSwapper.isSwapped&&this._enabled}disable(){this._enabled=!1,this.enabled}restore(){this._fnSwapper.restore()}enable(){this._enabled=!0,this._fnSwapper.isSwapped||this.swapToInterceptor()}swapToInterceptor(){const t=this;this._fnSwapper.swap(function(...o){if(!t._enabled)return t.callOriginalInvocator(...o);const a=t.runMiddlewares(o);if(a){if("output"in a)return a.output;"input"in a&&(o=a.input)}return t._interceptionFunction.call(this,t.getOriginalInvocator(this),...o)})}getOriginalInvocator(t){return this._fnSwapper.originalValue.bind(t??this._fnSwapper.target)}callOriginalInvocator(...t){return this.getOriginalInvocator()(...t)}runMiddlewares(t){for(const o of this._middlewares){const a=o(...t);if(a){if("output"in a)return a;"input"in a&&(t=a.input)}}return{input:t}}registerMiddleware(t){this._middlewares.push(t)}},no=class{constructor(t){ur(this,"_fetchInterceptor"),ur(this,"_interceptionFilters",new Set),this._fetchInterceptor=new ro(t,"fetch",(o,a,w)=>{for(const v of this._interceptionFilters)if(v.shouldIntercept(a,w))return this.shouldKeepFilter(v,a,w)||this.removeInterceptionFilter(v),v.intercept(a,w);return o(a,w)})}enable(){this._fetchInterceptor.enable()}disable(){this._fetchInterceptor.disable()}addInterceptionFilter(t){this.enable(),this._interceptionFilters.add(t)}removeInterceptionFilter(t){this._interceptionFilters.delete(t)}shouldKeepFilter(t,o,a){return typeof t.shouldKeep=="function"?t.shouldKeep(o,a):typeof t.shouldKeep=="boolean"?t.shouldKeep:!1}};new no(Qi());const io=[{async install(){const n=document.querySelector("#drawer wz-menu > wz-menu-sub-menu:nth-child(1) > wz-menu-item:nth-of-type(4)");if(!n||!(n instanceof HTMLElement))throw new Error("Unable to find school zone drawing menu item");const[t]=await Vi(async()=>{await Ji(n,$i([[[0,0],[0,1],[1,1],[0,0]]]).geometry)});if(t.actionName!=="ADD_BIG_JUNCTION")throw new Error("Unexpected action discovered when tried to resolve AddBigJunction action: "+t.actionName);const o=t.bigJunction;if(!o)throw new Error("Unexpected state: Added object does not exist");if(o.type!=="bigJunction")throw new Error("Unexpected state: Expected the added object to be a BigJunction instead of "+t.type);return{[or]:o.constructor,[ar]:t.constructor}}}],oo=[...io,...Ai];var ao=Object.defineProperty,so=(n,t,o)=>t in n?ao(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,B=(n,t,o)=>so(n,typeof t!="symbol"?t+"":t,o),uo=Object.defineProperty,co=(n,t,o)=>t in n?uo(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,ct=(n,t,o)=>co(n,typeof t!="symbol"?t+"":t,o),cr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},fr={};/*! *****************************************************************************
  Copyright (C) Microsoft. All rights reserved.
  Licensed under the Apache License, Version 2.0 (the "License"); you may not use
  this file except in compliance with the License. You may obtain a copy of the
  License at http://www.apache.org/licenses/LICENSE-2.0

  THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
  WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
  MERCHANTABLITY OR NON-INFRINGEMENT.

  See the Apache Version 2.0 License for specific language governing permissions
  and limitations under the License.
  ***************************************************************************** */var lr;function fo(){if(lr)return fr;lr=1;var n;return function(t){(function(o){var a=typeof globalThis=="object"?globalThis:typeof cr=="object"?cr:typeof self=="object"?self:typeof this=="object"?this:E(),w=v(t);typeof a.Reflect<"u"&&(w=v(a.Reflect,w)),o(w,a),typeof a.Reflect>"u"&&(a.Reflect=t);function v(P,I){return function(T,x){Object.defineProperty(P,T,{configurable:!0,writable:!0,value:x}),I&&I(T,x)}}function S(){try{return Function("return this;")()}catch{}}function O(){try{return(0,eval)("(function() { return this; })()")}catch{}}function E(){return S()||O()}})(function(o,a){var w=Object.prototype.hasOwnProperty,v=typeof Symbol=="function",S=v&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",O=v&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",E=typeof Object.create=="function",P={__proto__:[]}instanceof Array,I=!E&&!P,T={create:E?function(){return L(Object.create(null))}:P?function(){return L({__proto__:null})}:function(){return L({})},has:I?function(e,r){return w.call(e,r)}:function(e,r){return r in e},get:I?function(e,r){return w.call(e,r)?e[r]:void 0}:function(e,r){return e[r]}},x=Object.getPrototypeOf(Function),$=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Ie(),W=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Pe(),K=typeof WeakMap=="function"?WeakMap:Re(),R=v?Symbol.for("@reflect-metadata:registry"):void 0,V=Ee(),J=je(V);function we(e,r,i,s){if(d(i)){if(!ae(e))throw new TypeError;if(!se(r))throw new TypeError;return ve(e,r)}else{if(!ae(e))throw new TypeError;if(!b(r))throw new TypeError;if(!b(s)&&!d(s)&&!A(s))throw new TypeError;return A(s)&&(s=void 0),i=j(i),ge(e,r,i,s)}}o("decorate",we);function F(e,r){function i(s,h){if(!b(s))throw new TypeError;if(!d(h)&&!Se(h))throw new TypeError;te(e,r,s,h)}return i}o("metadata",F);function C(e,r,i,s){if(!b(i))throw new TypeError;return d(s)||(s=j(s)),te(e,r,i,s)}o("defineMetadata",C);function q(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=j(i)),Q(e,r,i)}o("hasMetadata",q);function G(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=j(i)),N(e,r,i)}o("hasOwnMetadata",G);function ye(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=j(i)),X(e,r,i)}o("getMetadata",ye);function Z(e,r,i){if(!b(r))throw new TypeError;return d(i)||(i=j(i)),ee(e,r,i)}o("getOwnMetadata",Z);function Y(e,r){if(!b(e))throw new TypeError;return d(r)||(r=j(r)),re(e,r)}o("getMetadataKeys",Y);function pe(e,r){if(!b(e))throw new TypeError;return d(r)||(r=j(r)),ne(e,r)}o("getOwnMetadataKeys",pe);function _e(e,r,i){if(!b(r))throw new TypeError;if(d(i)||(i=j(i)),!b(r))throw new TypeError;d(i)||(i=j(i));var s=D(r,i,!1);return d(s)?!1:s.OrdinaryDeleteMetadata(e,r,i)}o("deleteMetadata",_e);function ve(e,r){for(var i=e.length-1;i>=0;--i){var s=e[i],h=s(r);if(!d(h)&&!A(h)){if(!se(h))throw new TypeError;r=h}}return r}function ge(e,r,i,s){for(var h=e.length-1;h>=0;--h){var k=e[h],m=k(r,i,s);if(!d(m)&&!A(m)){if(!b(m))throw new TypeError;s=m}}return s}function Q(e,r,i){var s=N(e,r,i);if(s)return!0;var h=U(r);return A(h)?!1:Q(e,h,i)}function N(e,r,i){var s=D(r,i,!1);return d(s)?!1:oe(s.OrdinaryHasOwnMetadata(e,r,i))}function X(e,r,i){var s=N(e,r,i);if(s)return ee(e,r,i);var h=U(r);if(!A(h))return X(e,h,i)}function ee(e,r,i){var s=D(r,i,!1);if(!d(s))return s.OrdinaryGetOwnMetadata(e,r,i)}function te(e,r,i,s){var h=D(i,s,!0);h.OrdinaryDefineOwnMetadata(e,r,i,s)}function re(e,r){var i=ne(e,r),s=U(e);if(s===null)return i;var h=re(s,r);if(h.length<=0)return i;if(i.length<=0)return h;for(var k=new W,m=[],p=0,u=i;p<u.length;p++){var c=u[p],f=k.has(c);f||(k.add(c),m.push(c))}for(var l=0,y=h;l<y.length;l++){var c=y[l],f=k.has(c);f||(k.add(c),m.push(c))}return m}function ne(e,r){var i=D(e,r,!1);return i?i.OrdinaryOwnMetadataKeys(e,r):[]}function ie(e){if(e===null)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return e===null?1:6;default:return 6}}function d(e){return e===void 0}function A(e){return e===null}function be(e){return typeof e=="symbol"}function b(e){return typeof e=="object"?e!==null:typeof e=="function"}function me(e,r){switch(ie(e)){case 0:return e;case 1:return e;case 2:return e;case 3:return e;case 4:return e;case 5:return e}var i="string",s=ue(e,S);if(s!==void 0){var h=s.call(e,i);if(b(h))throw new TypeError;return h}return ke(e)}function ke(e,r){var i,s;{var h=e.toString;if(z(h)){var s=h.call(e);if(!b(s))return s}var i=e.valueOf;if(z(i)){var s=i.call(e);if(!b(s))return s}}throw new TypeError}function oe(e){return!!e}function Oe(e){return""+e}function j(e){var r=me(e);return be(r)?r:Oe(r)}function ae(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:Object.prototype.toString.call(e)==="[object Array]"}function z(e){return typeof e=="function"}function se(e){return typeof e=="function"}function Se(e){switch(ie(e)){case 3:return!0;case 4:return!0;default:return!1}}function H(e,r){return e===r||e!==e&&r!==r}function ue(e,r){var i=e[r];if(i!=null){if(!z(i))throw new TypeError;return i}}function ce(e){var r=ue(e,O);if(!z(r))throw new TypeError;var i=r.call(e);if(!b(i))throw new TypeError;return i}function fe(e){return e.value}function le(e){var r=e.next();return r.done?!1:r}function he(e){var r=e.return;r&&r.call(e)}function U(e){var r=Object.getPrototypeOf(e);if(typeof e!="function"||e===x||r!==x)return r;var i=e.prototype,s=i&&Object.getPrototypeOf(i);if(s==null||s===Object.prototype)return r;var h=s.constructor;return typeof h!="function"||h===e?r:h}function Me(){var e;!d(R)&&typeof a.Reflect<"u"&&!(R in a.Reflect)&&typeof a.Reflect.defineMetadata=="function"&&(e=Te(a.Reflect));var r,i,s,h=new K,k={registerProvider:m,getProvider:u,setProvider:f};return k;function m(l){if(!Object.isExtensible(k))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case e===l:break;case d(r):r=l;break;case r===l:break;case d(i):i=l;break;case i===l:break;default:s===void 0&&(s=new W),s.add(l);break}}function p(l,y){if(!d(r)){if(r.isProviderFor(l,y))return r;if(!d(i)){if(i.isProviderFor(l,y))return r;if(!d(s))for(var _=ce(s);;){var g=le(_);if(!g)return;var M=fe(g);if(M.isProviderFor(l,y))return he(_),M}}}if(!d(e)&&e.isProviderFor(l,y))return e}function u(l,y){var _=h.get(l),g;return d(_)||(g=_.get(y)),d(g)&&(g=p(l,y),d(g)||(d(_)&&(_=new $,h.set(l,_)),_.set(y,g))),g}function c(l){if(d(l))throw new TypeError;return r===l||i===l||!d(s)&&s.has(l)}function f(l,y,_){if(!c(_))throw new Error("Metadata provider not registered.");var g=u(l,y);if(g!==_){if(!d(g))return!1;var M=h.get(l);d(M)&&(M=new $,h.set(l,M)),M.set(y,_)}return!0}}function Ee(){var e;return!d(R)&&b(a.Reflect)&&Object.isExtensible(a.Reflect)&&(e=a.Reflect[R]),d(e)&&(e=Me()),!d(R)&&b(a.Reflect)&&Object.isExtensible(a.Reflect)&&Object.defineProperty(a.Reflect,R,{enumerable:!1,configurable:!1,writable:!1,value:e}),e}function je(e){var r=new K,i={isProviderFor:function(c,f){var l=r.get(c);return d(l)?!1:l.has(f)},OrdinaryDefineOwnMetadata:m,OrdinaryHasOwnMetadata:h,OrdinaryGetOwnMetadata:k,OrdinaryOwnMetadataKeys:p,OrdinaryDeleteMetadata:u};return V.registerProvider(i),i;function s(c,f,l){var y=r.get(c),_=!1;if(d(y)){if(!l)return;y=new $,r.set(c,y),_=!0}var g=y.get(f);if(d(g)){if(!l)return;if(g=new $,y.set(f,g),!e.setProvider(c,f,i))throw y.delete(f),_&&r.delete(c),new Error("Wrong provider for target.")}return g}function h(c,f,l){var y=s(f,l,!1);return d(y)?!1:oe(y.has(c))}function k(c,f,l){var y=s(f,l,!1);if(!d(y))return y.get(c)}function m(c,f,l,y){var _=s(l,y,!0);_.set(c,f)}function p(c,f){var l=[],y=s(c,f,!1);if(d(y))return l;for(var _=y.keys(),g=ce(_),M=0;;){var de=le(g);if(!de)return l.length=M,l;var Ae=fe(de);try{l[M]=Ae}catch(xe){try{he(g)}finally{throw xe}}M++}}function u(c,f,l){var y=s(f,l,!1);if(d(y)||!y.delete(c))return!1;if(y.size===0){var _=r.get(f);d(_)||(_.delete(l),_.size===0&&r.delete(_))}return!0}}function Te(e){var r=e.defineMetadata,i=e.hasOwnMetadata,s=e.getOwnMetadata,h=e.getOwnMetadataKeys,k=e.deleteMetadata,m=new K,p={isProviderFor:function(u,c){var f=m.get(u);return!d(f)&&f.has(c)?!0:h(u,c).length?(d(f)&&(f=new W,m.set(u,f)),f.add(c),!0):!1},OrdinaryDefineOwnMetadata:r,OrdinaryHasOwnMetadata:i,OrdinaryGetOwnMetadata:s,OrdinaryOwnMetadataKeys:h,OrdinaryDeleteMetadata:k};return p}function D(e,r,i){var s=V.getProvider(e,r);if(!d(s))return s;if(i){if(V.setProvider(e,r,J))return J;throw new Error("Illegal state.")}}function Ie(){var e={},r=[],i=function(){function p(u,c,f){this._index=0,this._keys=u,this._values=c,this._selector=f}return p.prototype["@@iterator"]=function(){return this},p.prototype[O]=function(){return this},p.prototype.next=function(){var u=this._index;if(u>=0&&u<this._keys.length){var c=this._selector(this._keys[u],this._values[u]);return u+1>=this._keys.length?(this._index=-1,this._keys=r,this._values=r):this._index++,{value:c,done:!1}}return{value:void 0,done:!0}},p.prototype.throw=function(u){throw this._index>=0&&(this._index=-1,this._keys=r,this._values=r),u},p.prototype.return=function(u){return this._index>=0&&(this._index=-1,this._keys=r,this._values=r),{value:u,done:!0}},p}(),s=function(){function p(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(p.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),p.prototype.has=function(u){return this._find(u,!1)>=0},p.prototype.get=function(u){var c=this._find(u,!1);return c>=0?this._values[c]:void 0},p.prototype.set=function(u,c){var f=this._find(u,!0);return this._values[f]=c,this},p.prototype.delete=function(u){var c=this._find(u,!1);if(c>=0){for(var f=this._keys.length,l=c+1;l<f;l++)this._keys[l-1]=this._keys[l],this._values[l-1]=this._values[l];return this._keys.length--,this._values.length--,H(u,this._cacheKey)&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},p.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},p.prototype.keys=function(){return new i(this._keys,this._values,h)},p.prototype.values=function(){return new i(this._keys,this._values,k)},p.prototype.entries=function(){return new i(this._keys,this._values,m)},p.prototype["@@iterator"]=function(){return this.entries()},p.prototype[O]=function(){return this.entries()},p.prototype._find=function(u,c){if(!H(this._cacheKey,u)){this._cacheIndex=-1;for(var f=0;f<this._keys.length;f++)if(H(this._keys[f],u)){this._cacheIndex=f;break}}return this._cacheIndex<0&&c&&(this._cacheIndex=this._keys.length,this._keys.push(u),this._values.push(void 0)),this._cacheIndex},p}();return s;function h(p,u){return p}function k(p,u){return u}function m(p,u){return[p,u]}}function Pe(){var e=function(){function r(){this._map=new $}return Object.defineProperty(r.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),r.prototype.has=function(i){return this._map.has(i)},r.prototype.add=function(i){return this._map.set(i,i),this},r.prototype.delete=function(i){return this._map.delete(i)},r.prototype.clear=function(){this._map.clear()},r.prototype.keys=function(){return this._map.keys()},r.prototype.values=function(){return this._map.keys()},r.prototype.entries=function(){return this._map.entries()},r.prototype["@@iterator"]=function(){return this.keys()},r.prototype[O]=function(){return this.keys()},r}();return e}function Re(){var e=16,r=T.create(),i=s();return function(){function u(){this._key=s()}return u.prototype.has=function(c){var f=h(c,!1);return f!==void 0?T.has(f,this._key):!1},u.prototype.get=function(c){var f=h(c,!1);return f!==void 0?T.get(f,this._key):void 0},u.prototype.set=function(c,f){var l=h(c,!0);return l[this._key]=f,this},u.prototype.delete=function(c){var f=h(c,!1);return f!==void 0?delete f[this._key]:!1},u.prototype.clear=function(){this._key=s()},u}();function s(){var u;do u="@@WeakMap@@"+p();while(T.has(r,u));return r[u]=!0,u}function h(u,c){if(!w.call(u,i)){if(!c)return;Object.defineProperty(u,i,{value:T.create()})}return u[i]}function k(u,c){for(var f=0;f<c;++f)u[f]=Math.random()*255|0;return u}function m(u){if(typeof Uint8Array=="function"){var c=new Uint8Array(u);return typeof crypto<"u"?crypto.getRandomValues(c):typeof msCrypto<"u"?msCrypto.getRandomValues(c):k(c,u),c}return k(new Array(u),u)}function p(){var u=m(e);u[6]=u[6]&79|64,u[8]=u[8]&191|128;for(var c="",f=0;f<e;++f){var l=u[f];(f===4||f===6||f===8)&&(c+="-"),l<16&&(c+="0"),c+=l.toString(16).toLowerCase()}return c}}function L(e){return e.__=void 0,delete e.__,e}})}(n||(n={})),fr}fo();var lo=Object.defineProperty,ho=(n,t,o)=>t in n?lo(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,Ye=(n,t,o)=>ho(n,typeof t!="symbol"?t+"":t,o);class po{constructor(t,o){Ye(this,"_target"),Ye(this,"_key"),Ye(this,"_oldValue"),Ye(this,"_wasDefined",!1),Ye(this,"_isSwapped",!1),this._target=t,this._key=o,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}}const yo={onlyIfNotExists:!0,isFactory:!1};class wo{constructor(t,o,a={}){if(ct(this,"_installedInstances",new Map),ct(this,"_path"),ct(this,"_targetValue"),ct(this,"_options"),this._path=t.split("."),this._path.length===0)throw new Error("Path must not be empty");this._targetValue=o,this._options={...yo,...a}}_getTargetObject(t){let o=t;for(const a of this._path.slice(0,this._path.length-1))o[a]||(o[a]={}),o=o[a];return o}_createSwapper(t){const o=this._getTargetObject(t);return new po(o,this._path.at(-1))}install({sdk:t,...o}){if(this._installedInstances.has(t))return;const a=this._createSwapper(t);if(!(a.value&&this._options.onlyIfNotExists)){if(this._options.isFactory&&typeof this._targetValue=="function"){const w=this._targetValue({sdk:t,...o});a.swap(w)}else a.swap(this._targetValue);this._installedInstances.set(t,a)}}uninstall({sdk:t}){const o=this._installedInstances.get(t);o&&(o.restore(),this._installedInstances.delete(t))}}class Ot extends Error{constructor(t){super(t),this.name="MiddlewareError"}}class _o extends Ot{constructor(t){super(t),this.name="MiddlewareFlowError"}}class vo extends Ot{constructor(t="Action prevented by middleware."){super(t),this.name="MiddlewarePreventedError"}}function ft(n){if(n===null||typeof n!="object")return n;if(Array.isArray(n))return n.map(o=>ft(o));if(n instanceof Date)return new Date(n);const t={};for(const o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=ft(n[o]));return t}function hr(n){Object.freeze(n);for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){const o=n[t];o&&typeof o=="object"&&hr(o)}return n}function go(n){let t=!1,o=null;const a=()=>t,w=()=>t=!0;return[function(...v){return w(),o=n.apply(this,v)},a,()=>{if(!t)throw new Error("Function has not been called yet");return o}]}class bo{constructor(t,o,a,w){B(this,"actionPoint"),B(this,"data"),B(this,"originalData"),B(this,"wmeSdk"),this.data=o,Object.defineProperty(this,"actionPoint",{value:t,writable:!1,configurable:!1,enumerable:!0}),Object.defineProperty(this,"originalData",{value:a,writable:!1,configurable:!1,enumerable:!0}),Object.defineProperty(this,"wmeSdk",{value:w,writable:!1,configurable:!1,enumerable:!0})}}class mo{constructor(t,o,a,w){B(this,"actionPoint"),B(this,"data"),B(this,"mutatedData"),B(this,"wmeSdk"),B(this,"handlers"),this.actionPoint=t,this.data=this.mutatedData=o,this.wmeSdk=a,this.handlers=w}getSafeImmutableData(){return hr(ft(this.data))}getSafeMutableData(){return ft(this.mutatedData)}createContext(){return new bo(this.actionPoint,this.getSafeMutableData(),this.getSafeImmutableData(),this.wmeSdk)}async run(t){let o=-1;const a=async w=>{if(w<=o)throw await new Promise(I=>setTimeout(I,1e3)),new _o("next() called multiple times within the same middleware or improperly nested.");if(o=w,w>=this.handlers.length)return t(this.mutatedData);const v=this.handlers[o],S=this.createContext(),[O,E,P]=go(()=>(this.mutatedData=S.data,a(w+1)));try{return await Promise.resolve(v(S,O)),E()?await P():(console.warn(`Middleware handler "${v.name||"anonymous"}" did not call next() and did not throw an error. This is not recommended and may cause unexpected behavior.
Ensure to always call next() or throw an error to stop the middleware chain.`),await O())}catch(I){if(I instanceof vo)return null;throw I}};return await a(0)}}class ko extends EventTarget{constructor(t){super(),B(this,"middleware",new Map),B(this,"wmeSdk"),this.wmeSdk=t}register(t,o){if(typeof o!="function")throw new Ot("Middleware handler must be a function.");const a=this.middleware.get(t)||[],w={handler:o};a.push(w),this.middleware.set(t,a),this.dispatchEvent(new CustomEvent("middlewareRegistered",{detail:{actionPoint:t}}));let v=!1;return()=>{if(v)return;const S=this.middleware.get(t);if(!S)return;const O=S.indexOf(w);O!==-1&&(S.splice(O,1),S.length===0&&this.middleware.delete(t),v=!0,this.dispatchEvent(new CustomEvent("middlewareUnregistered",{detail:{actionPoint:t}})))}}async execute(t,o,a){const w=this.middleware.get(t)||[];await new mo(t,o,this.wmeSdk,w.map(v=>v.handler)).run(a)}hasListeners(t){return this.middleware.has(t)&&(this.middleware.get(t)||[]).length>0}}const St=Symbol("REGISTRY");var Oo=Object.defineProperty,So=(n,t,o)=>t in n?Oo(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,Ce=(n,t,o)=>So(n,typeof t!="symbol"?t+"":t,o);class Mo{constructor(t,o){Ce(this,"_target"),Ce(this,"_key"),Ce(this,"_oldValue"),Ce(this,"_wasDefined",!1),Ce(this,"_isSwapped",!1),this._target=t,this._key=o,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}}let dr=class{constructor(n,t,o){Ce(this,"_enabled",!1),Ce(this,"_fnSwapper"),Ce(this,"_interceptionFunction"),Ce(this,"_middlewares",[]),this._fnSwapper=new Mo(n,t),this._interceptionFunction=o}get enabled(){return this._fnSwapper.isSwapped&&this._enabled}disable(){this._enabled=!1,this.enabled}restore(){this._fnSwapper.restore()}enable(){this._enabled=!0,this._fnSwapper.isSwapped||this.swapToInterceptor()}swapToInterceptor(){const n=this;this._fnSwapper.swap(function(...t){if(!n._enabled)return n.callOriginalInvocator(...t);const o=n.runMiddlewares(t);if(o){if("output"in o)return o.output;"input"in o&&(t=o.input)}return n._interceptionFunction.call(this,n.getOriginalInvocator(this),...t)})}getOriginalInvocator(n){return this._fnSwapper.originalValue.bind(n??this._fnSwapper.target)}callOriginalInvocator(...n){return this.getOriginalInvocator()(...n)}runMiddlewares(n){for(const t of this._middlewares){const o=t(...n);if(o){if("output"in o)return o;"input"in o&&(n=o.input)}}return{input:n}}registerMiddleware(n){this._middlewares.push(n)}};function Qe(){return"unsafeWindow"in window?window.unsafeWindow:window}class pr{constructor(t){B(this,"isMiddlewareDefined",!1),B(this,"uninstaller",null),B(this,"registry"),B(this,"artifacts"),B(this,"handleMiddlewareRegistered",o=>{o.detail.actionPoint===this.options.actionPoint&&this.defineMiddleware(this.artifacts)}),B(this,"handleMiddlewareUnregistered",o=>{var a;o.detail.actionPoint===this.options.actionPoint&&((a=this.registry)!=null&&a.hasListeners(this.options.actionPoint)||this.undefineMiddleware())}),this.options=t}addRegistryEvents(){var t,o;(t=this.registry)==null||t.addEventListener("middlewareRegistered",this.handleMiddlewareRegistered),(o=this.registry)==null||o.addEventListener("middlewareUnregistered",this.handleMiddlewareUnregistered)}removeRegistryEvents(){var t,o;(t=this.registry)==null||t.removeEventListener("middlewareRegistered",this.handleMiddlewareRegistered),(o=this.registry)==null||o.removeEventListener("middlewareUnregistered",this.handleMiddlewareUnregistered)}defineMiddleware(t){this.isMiddlewareDefined||(this.uninstaller=this.options.install(o=>new Promise(a=>{if(!this.registry)return a(o);this.registry.execute(this.options.actionPoint,o,a)}),t)||null,this.isMiddlewareDefined=!0)}undefineMiddleware(){var t;this.isMiddlewareDefined&&((t=this.uninstaller)==null||t.call(this),this.isMiddlewareDefined=!1)}install({artifacts:t}){var o;this.artifacts=t,this.registry=t[this.options.registryArtifactName??St],(o=this.registry)!=null&&o.hasListeners(this.options.actionPoint)&&this.defineMiddleware(t),this.addRegistryEvents()}uninstall(){this.removeRegistryEvents(),this.undefineMiddleware(),this.registry=void 0}}function Eo(){return new Promise(n=>{const t="problems:shown",o=Qe(),a=async w=>{if(w.type!=="mapUpdateRequest")return;o.W.app.off(t,a);const v=await o.W.problemsController.editController.adapter.getCommentable();n(v.constructor)};o.W.app.on(t,a)})}const jo=new pr({actionPoint:"updateRequests.addComment",install:n=>{let t=null;return Eo().then(o=>{t=new dr(o.prototype,"addComment",async function(a,w,...v){const S=await n({updateRequestId:this.conversation.getID(),message:w});return a(S.message,...v)}),t.enable()}),()=>{t==null||t.disable()}}});function To(n){return"subActions"in n&&Array.isArray(n.subActions)}const Io=["bigJunctions","cities","countries","editSuggestions","junctions","majorTrafficEvents","managedAreas","mapComments","mapProblems","mapUpdateRequests","nodes","onlineEditors","permanentHazards","problemDetails","restrictedDrivingAreas","restrictedEditingAreas","roadClosures","schedules","segments","segmentHouseNumbers","segmentSuggestions","signTypes","states","streets","turnClosures","updateRequestSessions","users","userAreas","venues"];function Mt(n,t){if(typeof n!="object"||n===null)return t;if(Array.isArray(n)&&Array.isArray(t))return[...n,...t];const o={...n};for(const a in t)t[a]!==void 0&&(a in o&&typeof o[a]=="object"?o[a]=Mt(o[a],t[a]):o[a]=t[a]);return o}function Po(n,t){if(!n||!t){const w=n||t;if(!w)throw new Error("Both responses are null or undefined");return w}const o=Et(n),a=Et(t);if(o&&a)return{pendingEdits:n.pendingEdits||t.pendingEdits,saveCount:{bigJunctions:n.saveCount.bigJunctions+t.saveCount.bigJunctions,nodes:n.saveCount.nodes+t.saveCount.nodes,segments:n.saveCount.segments+t.saveCount.segments,venues:n.saveCount.venues+t.saveCount.venues},unsavedFeatures:[...n.unsavedFeatures,...t.unsavedFeatures]};if(!o&&!a)return{...[...Io,"connections"].reduce((w,v)=>{const S=n[v],O=t[v];return S&&O?w[v]=Mt(S,O):S?w[v]=S:O&&(w[v]=O),w},{}),status:n.status,synced:n.synced,unsavedFeatures:Mt(n.unsavedFeatures,t.unsavedFeatures)};throw new Ro(n,t)}function Et(n){return"saveCount"in n}class Ro extends Error{constructor(t,o){super("Responses have different versions"),this.a=t,this.b=o}get preferredResponse(){return Et(this.a)?this.b:this.a}}function yr(n,t){const o=[];if(typeof t!="function"){const a=t;t=w=>a===w}for(const a in n){const w=n[a];if(t(w))return o.concat(parseInt(a));if(w.subActions){const v=yr(w.subActions,t);if(v)return o.concat(parseInt(a),...v)}}return null}class lt{constructor(t){B(this,"actions"),this.actions=t}getActionsFlat(){return this.actions.flatMap(t=>To(t)?t.getSubActions():[t])}getActionPath(t){return yr(this.actions,t)}hasAction(t){return this.getActionPath(t)!==null}removeAction(t){var o;const a=t.pop();let w={subActions:this.actions};for(;t.length;)w=(o=w.subActions)==null?void 0:o[t.shift()];a!==void 0&&w.subActions.splice(a,1)}replaceAction(t,...o){var a;const w=t.pop();let v={subActions:this.actions};for(;t.length;)v=(a=v.subActions)==null?void 0:a[t.shift()];w!==void 0&&v.subActions.splice(w,1,...o)}addAction(t){this.actions.push(t)}}class Ao{constructor(t,o){B(this,"saveInterceptor"),this.saveInterceptor=new dr(t.controller,"save",async function(a,w,...v){const S=new lt((w==null?void 0:w.actions)||this.model.actionManager.getActions()),O=await Promise.resolve(o(S));if(O){let E=null;for(const P of O){const I=await a({...w||{},actions:P.actions},...v);E?E=Po(E,I):E=I}return E}return a({...w||{},actions:S.actions},...v)})}enable(){return this.saveInterceptor.enable()}disable(){return this.saveInterceptor.disable()}}const xo="ADD_ROAD_CLOSURE";function jt(n){return(n==null?void 0:n.actionName)===xo&&(n==null?void 0:n.closure)!==void 0&&(n==null?void 0:n.segment)!==void 0}const $o="ADD_TURN_CLOSURE";function Tt(n){var t;return n.actionName===$o&&((t=n.getObject())==null?void 0:t.type)==="turnClosure"}function wr(n){return n.actionName==="UPDATE_OBJECT"}function _r(n){var t;return wr(n)&&((t=n.object)==null?void 0:t.type)==="roadClosure"}function vr(n){var t;return wr(n)&&((t=n.object)==null?void 0:t.type)==="turnClosure"}const Do="DELETE_ROAD_CLOSURE";function It(n){return(n==null?void 0:n.actionName)===Do&&(n==null?void 0:n.closure)!==void 0&&(n==null?void 0:n.segment)!==void 0}function Fo(n){return n.actionName==="DELETE_OBJECT"}function Pt(n){return Fo(n)&&n.object.type==="turnClosure"}function Vo(n){return n.filter(t=>jt(t)||Tt(t)||_r(t)||vr(t)||It(t)||Pt(t))}const Co={roadClosure:"SEGMENT",turnClosure:"TURN"};function Xe(n){const t={id:n.state==="INSERT"?null:n.attributes.id,closureType:Co[n.type],startDate:new Date(n.attributes.startDate),endDate:new Date(n.attributes.endDate),description:n.attributes.reason,eventId:n.attributes.eventId};switch(n.type){case"roadClosure":return{...t,closureType:"SEGMENT",permanent:n.getAttribute("permanent"),segmentId:n.getAttribute("segID"),forward:n.getAttribute("forward"),nodeClosure:n.getAttribute("fromNodeClosed"),provider:n.getAttribute("provider")};case"turnClosure":return{...t,closureType:"TURN",permanent:!0,fromSegmentId:n.getAttribute("fromSegID"),fromSegmentForward:n.getAttribute("fromSegForward"),toSegmentId:n.getAttribute("toSegID"),toSegmentForward:n.getAttribute("toSegForward"),nodeId:n.getAttribute("nodeConnID")}}}function gr(n,t){return typeof n!=typeof t||typeof n!="object"||!n||!t?!1:Object.keys(n).every(o=>{if(!Object.prototype.hasOwnProperty.call(t,o))return!1;const a=n[o],w=t[o];return gr(a,w)})}function zo(n,t){return t.some(o=>gr(o,n))}function br(n,t){return n.length!==t.length?!1:n.every(o=>zo(o,t))}var Ko=Object.defineProperty,Wo=(n,t,o)=>t in n?Ko(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,et=(n,t,o)=>Wo(n,typeof t!="symbol"?t+"":t,o);let No=class{constructor(n,t){et(this,"_target"),et(this,"_key"),et(this,"_oldValue"),et(this,"_wasDefined",!1),et(this,"_isSwapped",!1),this._target=n,this._key=t,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(n){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=n,this._isSwapped=!0}};function Rt(){return"unsafeWindow"in window?window.unsafeWindow:window}var Ho=Object.defineProperty,Uo=(n,t,o)=>t in n?Ho(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,mr=(n,t,o)=>Uo(n,typeof t!="symbol"?t+"":t,o);function tt(){return"unsafeWindow"in window?window.unsafeWindow:window}var Lo=Object.defineProperty,qo=(n,t,o)=>t in n?Lo(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,ze=(n,t,o)=>qo(n,typeof t!="symbol"?t+"":t,o);class Go{constructor(t,o){ze(this,"_target"),ze(this,"_key"),ze(this,"_oldValue"),ze(this,"_wasDefined",!1),ze(this,"_isSwapped",!1),this._target=t,this._key=o,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}}class Bo{constructor(t,o,a){ze(this,"_enabled",!1),ze(this,"_fnSwapper"),ze(this,"_interceptionFunction"),ze(this,"_middlewares",[]),this._fnSwapper=new Go(t,o),this._interceptionFunction=a}get enabled(){return this._fnSwapper.isSwapped&&this._enabled}disable(){this._enabled=!1,this.enabled}restore(){this._fnSwapper.restore()}enable(){this._enabled=!0,this._fnSwapper.isSwapped||this.swapToInterceptor()}swapToInterceptor(){const t=this;this._fnSwapper.swap(function(...o){if(!t._enabled)return t.callOriginalInvocator(...o);const a=t.runMiddlewares(o);if(a){if("output"in a)return a.output;"input"in a&&(o=a.input)}return t._interceptionFunction.call(this,t.getOriginalInvocator(this),...o)})}getOriginalInvocator(t){return this._fnSwapper.originalValue.bind(t??this._fnSwapper.target)}callOriginalInvocator(...t){return this.getOriginalInvocator()(...t)}runMiddlewares(t){for(const o of this._middlewares){const a=o(...t);if(a){if("output"in a)return a;"input"in a&&(t=a.input)}}return{input:t}}registerMiddleware(t){this._middlewares.push(t)}}class Jo{constructor(t){mr(this,"_fetchInterceptor"),mr(this,"_interceptionFilters",new Set),this._fetchInterceptor=new Bo(t,"fetch",(o,a,w)=>{for(const v of this._interceptionFilters)if(v.shouldIntercept(a,w))return this.shouldKeepFilter(v,a,w)||this.removeInterceptionFilter(v),v.intercept(a,w);return o(a,w)})}enable(){this._fetchInterceptor.enable()}disable(){this._fetchInterceptor.disable()}addInterceptionFilter(t){this.enable(),this._interceptionFilters.add(t)}removeInterceptionFilter(t){this._interceptionFilters.delete(t)}shouldKeepFilter(t,o,a){return typeof t.shouldKeep=="function"?t.shouldKeep(o,a):typeof t.shouldKeep=="boolean"?t.shouldKeep:!1}}function Zo(n){return n=n instanceof URL?n:new URL(n,tt().location.href),t=>typeof t=="string"?new URL(t,tt().location.href).pathname===n.pathname:t instanceof URL?t.pathname===n.pathname:new URL(t.url,tt().location.href).pathname===new URL(n,tt().location.href).pathname}function Yo(n,t,o){const a=new Response(t,o),w=new URL(n,location.toString());return Object.defineProperty(a,"url",{value:w}),a}function Qo(n,t){const o=JSON.stringify(t),a=new Headers({"Content-Type":"application/json"});return Yo(n,o,{headers:a})}const Xo=new Jo(tt());function ea(n){return!("descartesHttpClient"in n)&&"createAbortController"in n&&typeof n.createAbortController=="function"}function ta(){const n=Rt().W.controller.descartesClient,t=ea(n)?n:n.descartesHttpClient,o=new No(t,"createAbortController");o.swap(()=>(o.restore(),new AbortController))}function ra(n){const t=Rt();return ta(),t.W.controller.descartesClient.getFeatures([0,0,0,0],{[n]:!0},{})}async function kr(n,t){const o=Rt().W.Config.paths.features;Xo.addInterceptionFilter({shouldIntercept:Zo(o),intercept(){return Promise.resolve(Qo(o,{[n]:{objects:[t]}}))}});const{[n]:a}=await ra(n),[w]=a.objects;return w.constructor}const Or=Symbol("TurnClosure"),Sr=Symbol("RoadClosure");function Mr(n){const t=n.getFullYear().toString().padStart(4,"0"),o=(n.getMonth()+1).toString().padStart(2,"0"),a=n.getDate().toString().padStart(2,"0"),w=n.getHours().toString().padStart(2,"0"),v=n.getMinutes().toString().padStart(2,"0");return`${t}-${o}-${a} ${w}:${v}`}function na(n){const t=Qe(),o={SEGMENT:"roadClosure",TURN:"turnClosure"};return t.W.model.getRepository(o[n])}function ia(n,t){const o={id:n.id||na(n.closureType).idGenerator.next(),attributions:null,reason:n.description,startDate:Mr(n.startDate),endDate:Mr(n.endDate),eventId:n.eventId,externalProvider:null,externalProviderId:null,provider:null,createdBy:null,createdOn:null,updatedBy:null,updatedOn:null,permissions:-1,geometry:null};switch(n.closureType){case"SEGMENT":return new t[Sr]({...o,closureType:"SEGMENT",permanent:n.permanent,segID:n.segmentId,forward:n.forward,fromNodeClosed:n.nodeClosure});case"TURN":return new t[Or]({...o,closureType:"TURN",permanent:!0,fromSegID:n.fromSegmentId,fromSegForward:n.fromSegmentForward,toSegID:n.toSegmentId,toSegForward:n.toSegmentForward,nodeConnID:n.nodeId})}}function Er(n){return jt(n)?{...Xe(n.closure),id:null}:Tt(n)?{...Xe(n.getObject()),id:null}:_r(n)?Xe(n.getObject()):It(n)?Xe(n.closure):vr(n)||Pt(n)?Xe(n.getObject()):null}const oa=[{async install(){const n=await kr("roadClosures",{});return{[Sr]:n}}},{async install(){const n=await kr("turnClosures",{});return{[Or]:n}}},new pr({actionPoint:"closures.save",install:(n,t)=>{const o=Qe(),a=new Ao(o.W,async w=>{var v,S;const O=w.getActionsFlat(),E=Vo(O);if(!E.length)return;const{delete:P,set:I}=E.reduce((F,C)=>((It(C)||Pt(C)?F.delete:F.set).push(C),F),{delete:[],set:[]}),T={source:void 0,closures:I.map(Er).filter(Boolean),deleteClosures:P.map(Er).filter(Boolean)},x=await n(T),$=br(T.closures,x.closures),W=br(T.deleteClosures,x.deleteClosures);if(!$&&!W)return;const K=(v=E.find(F=>jt(F)))==null?void 0:v.constructor,R=(S=E.find(F=>Tt(F)))==null?void 0:S.constructor;E.forEach(F=>{const C=w.getActionPath(F);C&&(w.removeAction(C),F.undoAction(o.W.model))});const{addClosureActions:V,updateClosureActions:J}=x.closures.reduce((F,C)=>{const q=Qe(),G=ia(C,t);if(!G)return F;if(!C.id){const Z=(()=>{switch(C.closureType){case"SEGMENT":{if(!K){const pe=q.require("Waze/Action/CreateObject");return new pe(G)}const Y=q.W.model.segments.getObjectById(C.segmentId);return new K(G,Y)}case"TURN":{if(!R){const _e=q.require("Waze/Action/CreateObject");return new _e(G)}const Y=q.W.model.segments.getObjectById(C.fromSegmentId),pe=q.W.model.segments.getObjectById(C.toSegmentId);return new R(G,Y,pe)}default:throw new Error("Unregistered closure factory for closure type "+C.closureType)}})();Z&&F.addClosureActions.push(Z)}const ye=(()=>{const Z=q.W.model.getRepository(C.closureType==="SEGMENT"?"roadClosure":"turnClosure").getObjectById(C.id);if(!Z)return null;const Y=q.require("Waze/Action/UpdateObject");return new Y(Z,G.attributes)})();return ye&&F.updateClosureActions.push(ye),F},{addClosureActions:[],updateClosureActions:[]}),we=x.deleteClosures.map(F=>{const C=Qe(),q=C.W.model.getRepository(F.closureType==="SEGMENT"?"roadClosure":"turnClosure").getObjectById(F.id);if(!q)return null;const G=C.require("Waze/Action/DeleteObject");return new G(q)});return[new lt(J.filter(Boolean)),new lt(we.filter(Boolean)),new lt(V.filter(Boolean))].filter(F=>F.actions.length>0)});return a.enable(),()=>{a.disable()}}})],aa=[{install:({sdk:n})=>({[St]:new ko(n)})},new wo("Events.registerMiddleware",({artifacts:n})=>(t,o)=>{const a=n[St];if(!a)throw new Error("Middleware registry not found in artifacts");return a==null?void 0:a.register(t,o)},{isFactory:!0}),jo,...oa];function jr(n,t,o){return{eventName:n,effect:t,onSubscribed:o==null?void 0:o.onSubscribed,onUnsubscribed:o==null?void 0:o.onUnsubscribed}}const sa=jr("wme-feature-editor-rendered",({wmeSdk:n,trigger:t})=>{const o=({featureType:a})=>{t({featureType:a})};return n.Events.on({eventName:"wme-feature-editor-opened",eventHandler:o}),()=>{n.Events.off({eventName:"wme-feature-editor-opened",eventHandler:o})}},{onSubscribed(){console.warn('[WME SDK+]: Event "wme-feature-editor-rendered" is deprecated. Please use native "wme-feature-editor-opened" instead.')}}),Tr={"sidepanel-issue-tracker":"issue_tracker","sidepanel-drives":"drives","sidepanel-areas":"areas","sidepanel-prefs":"prefs","sidepanel-mtes":"mtes","sidepanel-feature-editor":"feature_editor"},ua={none:"",feature_editor:"select",issue_tracker:"solve",mtes:"events",prefs:"settings",userscript_tab:"scripts",drives:"drives",areas:"areas"};function At(n){return!!(n instanceof HTMLElement&&n.classList.contains("tab-pane")&&n.classList.contains("sidebar-tab-pane")&&n.id&&Object.prototype.hasOwnProperty.call(Tr,n.id))}const ca=jr("wme-sidebar-tab-opened",({trigger:n})=>{var t;const o=v=>{const S=Tr[v.id];S&&n({tabType:ua[S],tabElement:v})},a=new MutationObserver((v,S)=>{for(const O of v)switch(O.type){case"childList":O.addedNodes.forEach(E=>{At(E)&&(o(E),S.observe(E,{attributes:!0}))});break;case"attributes":{if(O.attributeName!=="id"||!At(O.target))break;o(O.target);break}}}),w=(t=document.getElementById("sidebarContent"))==null?void 0:t.querySelector(".tab-content");if(w){a.observe(w,{childList:!0});const v=Array.from(w.getElementsByClassName("sidebar-tab-pane"));for(const S of v)At(S)&&a.observe(S,{attributes:!0})}return()=>{a.disconnect()}});var fa=Object.defineProperty,la=(n,t,o)=>t in n?fa(n,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):n[t]=o,Ke=(n,t,o)=>la(n,typeof t!="symbol"?t+"":t,o);class ha{constructor(t,o){Ke(this,"_target"),Ke(this,"_key"),Ke(this,"_oldValue"),Ke(this,"_wasDefined",!1),Ke(this,"_isSwapped",!1),this._target=t,this._key=o,this._oldValue=this._target[this._key]}get isSwapped(){return this._isSwapped}get originalValue(){return this._oldValue}get value(){return this._target[this._key]}get target(){return this._target}restore(){this.isSwapped&&(this._wasDefined?this._target[this._key]=this._oldValue:delete this._target[this._key],this._isSwapped=!1)}swap(t){this.isSwapped||(this._wasDefined=Object.hasOwn(this._target,this._key),this._oldValue=this._target[this._key]),this._target[this._key]=t,this._isSwapped=!0}}class xt{constructor(t,o,a){Ke(this,"_enabled",!1),Ke(this,"_fnSwapper"),Ke(this,"_interceptionFunction"),Ke(this,"_middlewares",[]),this._fnSwapper=new ha(t,o),this._interceptionFunction=a}get enabled(){return this._fnSwapper.isSwapped&&this._enabled}disable(){this._enabled=!1,this.enabled}restore(){this._fnSwapper.restore()}enable(){this._enabled=!0,this._fnSwapper.isSwapped||this.swapToInterceptor()}swapToInterceptor(){const t=this;this._fnSwapper.swap(function(...o){if(!t._enabled)return t.callOriginalInvocator(...o);const a=t.runMiddlewares(o);if(a){if("output"in a)return a.output;"input"in a&&(o=a.input)}return t._interceptionFunction.call(this,t.getOriginalInvocator(this),...o)})}getOriginalInvocator(t){return this._fnSwapper.originalValue.bind(t??this._fnSwapper.target)}callOriginalInvocator(...t){return this.getOriginalInvocator()(...t)}runMiddlewares(t){for(const o of this._middlewares){const a=o(...t);if(a){if("output"in a)return a;"input"in a&&(t=a.input)}}return{input:t}}registerMiddleware(t){this._middlewares.push(t)}}const Ir=Symbol("EVENT CLEANUPS"),Pr=[sa,ca];function $t(n){return Pr.find(t=>t.eventName===n)||null}const da={"Editing.Transactions":{hook:rn},"DataModel.MapComments":{hook:Cn},"DataModel.PermanentHazards":{hook:mi},"DataModel.BigJunctions":{hook:oo},Events:{hook:[{install({sdk:n,artifacts:t}){const o=n.Events.eventBus,a=[];Pr.forEach(w=>{const v=w.effect({wmeSdk:n,eventBus:o,trigger(S){o.trigger(w.eventName,S)}});v&&a.push(v)}),t[Ir]=a},uninstall({artifacts:n}){n[Ir].forEach(t=>t())}},({sdk:n})=>{const t=new xt(n.Events,"on",(o,a,...w)=>{var v;const S=()=>o(a,...w),{eventName:O,eventHandler:E}=a;if(w.length||!O||!E)return S();const P=$t(O);if(!P)return S();const I=n.Events.eventBus.on(O,E);return(v=P.onSubscribed)==null||v.call(P),I});return t.enable(),()=>t.disable()},({sdk:n})=>{const t=new xt(n.Events,"once",(o,a,...w)=>{var v;const S=()=>o(a,...w),{eventName:O}=a;if(w.length||!O)return S();const E=$t(O);if(!E)return S();const P=n.Events.eventBus.once(O);return(v=E.onSubscribed)==null||v.call(E),P});return t.enable(),()=>t.disable()},({sdk:n})=>{const t=new xt(n.Events,"off",(o,a,...w)=>{var v;const S=()=>o(a,...w),{eventName:O,eventHandler:E}=a;if(w.length||!O)return S();const P=$t(O);if(!P)return S();const I=n.Events.eventBus.off(O,E);return(v=P.onUnsubscribed)==null||v.call(P),I});return t.enable(),()=>t.disable()}]},Middlewares:{hook:aa}};function Dt(n){const[t,o,a]=n.split(".").map(Number);return{major:t,minor:o,patch:a}}function Ft(n,t){return n?t?n.major&&t.major&&n.major!==t.major?n.major-t.major:n.minor&&t.minor&&n.minor!==t.minor?n.minor-t.minor:n.patch&&t.patch&&n.patch!==t.patch?n.patch-t.patch:0:1:-1}function pa(n,t,o="highest"){let a=null;typeof n.highest=="string"&&(n.highest=Dt(n.highest)),typeof n.lowest=="string"&&(n.lowest=Dt(n.lowest));for(const w of t){if(!w.version)continue;if(!a){a=w;continue}if(n.highest&&Ft(w.version,n.highest)>0||n.lowest&&Ft(w.version,n.lowest)<0)continue;const v=w.version,S=a.version,O=Ft(v,S);(o==="highest"&&O>0||o==="lowest"&&O<0)&&(a=w)}if(!a)throw new Error("No matching version found");return a}const ya={"0.1":n=>{const t=n.constructor;return new t(n.getScriptId(),n.getScriptName())}};function wa(n){const t=Object.entries(ya).map(([a,w])=>({version:Dt(a),cloner:w})),{cloner:o}=pa({highest:n.getSDKVersion()},t);return o(n)}const Rr=new Dr(da);async function _a(n,t={}){if(t.immutable&&(n=wa(n)),n.State.isInitialized()||await n.Events.once({eventName:"wme-initialized"}),t.hooks)for(const o of t.hooks)await Rr.installHook(o,n);else await Rr.installAllHooks(n);return n}return _a}();
